
<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Triangles: unstructured meshes &mdash; Finite Element Modeling in Geodynamics  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=3d3fbe02" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=4c969af8" />
      <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/style.css?v=379f3234" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/tabs.js?v=3ee01567"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=9b54adf2"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Overview" href="../lecture6/overview.html" />
    <link rel="prev" title="Overview" href="overview.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Finite Element Modeling in Geodynamics
              <img src="../_static/triangle_fem_cover.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
    
              <p class="caption" role="heading"><span class="caption-text">Course information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../general-info/course-details.html">Course details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general-info/installation.html">Installation guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Lecture 1</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../lecture1/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture1/fdm_intro.html">Introduction: The Finite Differences Method (FDM)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture1/example_1.html">Example 1: Cooling dike</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture1/example_2.html">Example 2: Cooling dike - implicit version</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture1/example_3.html">Example 3: Periodic variations in seafloor temperature</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture1/fdm_advection.html">Transport problems with FDM</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Lecture 2</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../lecture2/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture2/mwr_intro.html">Introduction: Method of Weighted Residuals (MWR)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture2/mwr_examples.html">MWR solutions of the steady advection-diffusion equation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture2/excercises.html">Excercises</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Lecture 3</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../lecture3/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture3/fem_intro.html">Introduction Finite Element Method (FEM)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture3/fem_intro.html#fem-implementation">FEM implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture3/fem_advection.html">FEM and advection problems</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Lecture 4</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../lecture4/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture4/fem_in_2d.html">2-D FEM - elliptic problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture4/fem_in_2d.html#implementation">Implementation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Lecture 5</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Triangles: unstructured meshes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#theoretical-background">Theoretical background</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#excercise">Excercise</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#step-0-getting-ready">Step 0: getting ready</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-1-mesh-generation">Step 1: mesh generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-2-triangle-shape-functions-and-integration-points">Step 2: triangle shape functions and integration points</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-3-boundary-conditions">Step 3: Boundary conditions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-4-post-processing-and-plotting">Step 4: Post-processing and plotting</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Lecture 6</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../lecture6/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture6/transient_problems.html">Transient heat diffusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture6/turing_coupled_problem.html">Coupled diffusion problems</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Lecture 7</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../lecture7/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture7/intro-stokes.html">Introduction to Stokes flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture7/fem_formulation.html">Finite Element Formulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture7/python-implementation.html">Python implementation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../refs.html">References</a></li>
</ul>


    
        <p class="caption">
            <span class="caption-text">Getting help</span>
        </p>
        <ul>
            
                <li class="toctree-l1"><a href="https://lruepke.github.io/HTF_lecture/imprint/"><i class="fa fa-stamp"></i> Imprint</a></li>
            
                <li class="toctree-l1"><a href="mailto:lruepke@geomar.de"><i class="fa fa-envelope fa-fw"></i> Prof. Lars Ruepke</a></li>
            
                <li class="toctree-l1"><a href="mailto:zguo@geomar.de"><i class="fa fa-envelope fa-fw"></i> Dr. Zhikui Guo</a></li>
            
                <li class="toctree-l1"><a href="https://lruepke.github.io/FEM_lecture/"><i class="fa fa-home fa-fw"></i> Public site</a></li>
            
                <li class="toctree-l1"><a href="https://lms.uni-kiel.de/url/RepositoryEntry/3664576582"><i class="fa fa-home fa-fw"></i> University site</a></li>
            
        </ul>
    

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Finite Element Modeling in Geodynamics</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Triangles: unstructured meshes</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/lruepke/HTF_lecture/blob/main//source/lecture5/FEM_triangles.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="triangles-unstructured-meshes">
<h1>Triangles: unstructured meshes<a class="headerlink" href="#triangles-unstructured-meshes" title="Link to this heading"></a></h1>
<p>In this session we will learn</p>
<blockquote>
<div><ul class="simple">
<li><p>how to use a mesh generator to mesh complex geometries,</p></li>
<li><p>what changes are needed to change the basic element.</p></li>
</ul>
</div></blockquote>
<p>The problem we will look at is basically the same as in the example given above. We will resolve steady-state heat diffusion within a rectangular region but now we will have circular inclusions of different thermal conductivity.</p>
<section id="theoretical-background">
<h2>Theoretical background<a class="headerlink" href="#theoretical-background" title="Link to this heading"></a></h2>
<p>Let’s first explore how triangle element “work”. <a class="reference internal" href="#fig-fem-triangle-coords-f"><span class="std std-numref">Fig. 16</span></a>  shows a triangle in global and local coordinates. The local node numering is again counterclockwise.</p>
<figure class="align-center" id="fig-fem-triangle-coords-f">
<img alt="../_images/triangle_coords.png" src="../_images/triangle_coords.png" />
<figcaption>
<p><span class="caption-number">Fig. 16 </span><span class="caption-text">Global and local coordinates of a triangle element. Black crosses mark the locations of the three integration points.</span><a class="headerlink" href="#fig-fem-triangle-coords-f" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Here we look at a linear triangle with three nodes. The relation between global and local coordinates is therefore:</p>
<div class="math notranslate nohighlight" id="equation-eq-triangle-1">
<span class="eqno">(135)<a class="headerlink" href="#equation-eq-triangle-1" title="Link to this equation"></a></span>\[\begin{split}\begin{align}
\begin{split}
x &amp;= x_1 + (x_2-x_1)\xi + (x_3-x_1)\eta \\
y &amp;= y_1 + (y_2-y_1)\xi + (y_3-y_1)\eta \\
\end{split}
\end{align}\end{split}\]</div>
<p>Temperature, or any other variable, will also vary linearly with the local coordinates and we can write</p>
<div class="math notranslate nohighlight" id="equation-eq-triangle-2">
<span class="eqno">(136)<a class="headerlink" href="#equation-eq-triangle-2" title="Link to this equation"></a></span>\[T(\xi,\eta) = a_1 +a_2\xi + a_3\eta\]</div>
<p>We can spell this out for the three nodes:</p>
<div class="math notranslate nohighlight" id="equation-eq-triangle-3">
<span class="eqno">(137)<a class="headerlink" href="#equation-eq-triangle-3" title="Link to this equation"></a></span>\[\begin{split}\begin{align}
\begin{split}
T_1 &amp;= T(0,0) = a_1 \\
T_2 &amp;= T(1,0) = a_1 + a_2 \\
T_3 &amp;= T(0,1) = a_1 + a_3
\end{split}
\end{align}\end{split}\]</div>
<p>And express the contants <span class="math notranslate nohighlight">\(a\)</span> in terms of the nodal temperatures (or whatever our unknown is).</p>
<div class="math notranslate nohighlight" id="equation-eq-triangle-4">
<span class="eqno">(138)<a class="headerlink" href="#equation-eq-triangle-4" title="Link to this equation"></a></span>\[\begin{split}\begin{align}
\begin{split}
a_1 = T_1 \\
a_2 = T_2 - T_1 \\
a_3 = T_3 - T_1
\end{split}
\end{align}\end{split}\]</div>
<p>This we put back into the definition of the approximate solution <a class="reference internal" href="#equation-eq-triangle-2">equation (136)</a> and get:</p>
<div class="math notranslate nohighlight" id="equation-eq-triangle-5">
<span class="eqno">(139)<a class="headerlink" href="#equation-eq-triangle-5" title="Link to this equation"></a></span>\[\begin{split}\begin{align}
\begin{split}
T(\xi,\eta) &amp;= T_1 +(T_2 - T_1)\xi + (T_3-T_1)\eta\\
\Rightarrow \\
T(\xi,\eta) &amp;= (1 -\xi - \eta)T_1 + \xi T_2 + \eta T_3 \\
\Rightarrow \\
N_1(\xi, \eta) &amp;=  (1 -\xi - \eta)\\
N_2(\xi, \eta) &amp;=  \xi \\
N_3(\xi, \eta) &amp;=  \eta \\
\Rightarrow \\
T(\xi,\eta) &amp;= N_1 T_1 + N_2 T_2 + N_3 T_3 \\
\end{split}
\end{align}\end{split}\]</div>
<p>Alright, now that we understand the local coordinates and the shape functions associated with linear triangle element, we are good to go!</p>
</section>
</section>
<section id="excercise">
<h1>Excercise<a class="headerlink" href="#excercise" title="Link to this heading"></a></h1>
<section id="step-0-getting-ready">
<h2>Step 0: getting ready<a class="headerlink" href="#step-0-getting-ready" title="Link to this heading"></a></h2>
<p>Make a copy of the example solver above. Take it as a starting point and integrate the various code pieces and pieces of information below into.</p>
</section>
<section id="step-1-mesh-generation">
<h2>Step 1: mesh generation<a class="headerlink" href="#step-1-mesh-generation" title="Link to this heading"></a></h2>
<p>We will use the mesh generator <a class="reference external" href="https://www.cs.cmu.edu/~quake/triangle.html">triangle</a> by Jonathan Shewchuk. It’s one of the best 2-D mesh generators for triangle meshes. It’s originally written in C but we will for convenience use a python wrapper. You can install it into your virtual environment by doing this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>triangle
</pre></div>
</div>
<p>Here is a code piece for making the the mesh:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">triangle</span> <span class="k">as</span> <span class="nn">tr</span>

<span class="c1">## Create the triangle mesh</span>
<span class="n">vertices</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">segments</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">regions</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># make a box with given dims and place given attribute at its center</span>
<span class="k">def</span> <span class="nf">make_box</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">attribute</span><span class="p">):</span>
    <span class="n">i</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>

    <span class="n">vertices</span><span class="o">.</span><span class="n">extend</span><span class="p">([[</span><span class="n">x</span><span class="p">,</span>   <span class="n">y</span><span class="p">],</span>
                    <span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="n">w</span><span class="p">,</span> <span class="n">y</span><span class="p">],</span>
                    <span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="n">w</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="p">],</span>
                    <span class="p">[</span><span class="n">x</span><span class="p">,</span>   <span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="p">]])</span>

    <span class="n">segments</span><span class="o">.</span><span class="n">extend</span><span class="p">([(</span><span class="n">i</span><span class="o">+</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">0</span><span class="p">)])</span>

    <span class="n">regions</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span><span class="o">+</span><span class="mf">0.01</span><span class="o">*</span><span class="n">w</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mf">0.01</span><span class="o">*</span><span class="n">h</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span><span class="mf">0.005</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">make_inclusion</span><span class="p">(</span><span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">points_inc</span><span class="p">,</span> <span class="n">attribute</span><span class="p">):</span>
    <span class="n">theta</span>        <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="n">points_inc</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">xx</span>           <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">yy</span>           <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

    <span class="n">i</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
    <span class="n">vertices</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">center_x</span> <span class="o">+</span> <span class="n">radius</span><span class="o">*</span><span class="n">xx</span><span class="p">,</span><span class="n">center_y</span> <span class="o">+</span> <span class="n">radius</span><span class="o">*</span><span class="n">yy</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

    <span class="n">Tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="n">points_inc</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="n">points_inc</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span>
    <span class="n">Tmp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
    <span class="n">segments</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">Tmp</span><span class="p">)</span>

    <span class="n">regions</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span><span class="mf">0.001</span><span class="p">])</span>

<span class="c1">#geometry</span>
<span class="n">x0</span>          <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">y0</span>          <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">lx</span>          <span class="o">=</span> <span class="mi">2</span>
<span class="n">ly</span>          <span class="o">=</span> <span class="mi">2</span>
<span class="n">n_incl</span>      <span class="o">=</span> <span class="mi">5</span>
<span class="n">radius</span>      <span class="o">=</span> <span class="mf">0.15</span>

<span class="c1"># generate input</span>
<span class="n">make_box</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">lx</span><span class="p">,</span> <span class="n">ly</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">make_inclusion</span><span class="p">(</span><span class="o">-</span><span class="mf">0.8</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">make_inclusion</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">make_inclusion</span><span class="p">(</span><span class="o">-</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">make_inclusion</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">make_inclusion</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">make_inclusion</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">make_inclusion</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">.3</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">make_inclusion</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">.8</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">make_inclusion</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">.75</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">make_inclusion</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">.05</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">make_inclusion</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">.75</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="n">A</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">vertices</span><span class="o">=</span><span class="n">vertices</span><span class="p">,</span> <span class="n">segments</span><span class="o">=</span><span class="n">segments</span><span class="p">,</span> <span class="n">regions</span><span class="o">=</span><span class="n">regions</span><span class="p">)</span>
<span class="n">B</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">triangulate</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="s1">&#39;pq33Aa&#39;</span><span class="p">)</span>
<span class="c1">#tr.compare(plt, A, B)</span>
<span class="c1">#plt.show()</span>

<span class="c1"># extract mesh information</span>
<span class="n">GCOORD</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vertices&quot;</span><span class="p">)</span>
<span class="n">EL2NOD</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;triangles&quot;</span><span class="p">)</span>
<span class="n">Phases</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;triangle_attributes&quot;</span><span class="p">)</span>

<span class="n">nnodel</span> <span class="o">=</span> <span class="n">EL2NOD</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">nel</span>    <span class="o">=</span> <span class="n">EL2NOD</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">nnod</span>   <span class="o">=</span> <span class="n">GCOORD</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">Phases</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Phases</span><span class="p">,</span><span class="n">nel</span><span class="p">)</span>
</pre></div>
</div>
<p>Note how the generated mesh comes back as a python dictionary from which we extract the mesh information. Note also that the array <code class="code docutils literal notranslate"><span class="pre">Phases</span></code> contains a marker to which region an element belongs (matrix versus inclusion).</p>
</section>
<section id="step-2-triangle-shape-functions-and-integration-points">
<h2>Step 2: triangle shape functions and integration points<a class="headerlink" href="#step-2-triangle-shape-functions-and-integration-points" title="Link to this heading"></a></h2>
<p><a class="reference internal" href="../lecture4/fem_in_2d.html#fig-shapefunc-2d-linear"><span class="std std-numref">Fig. 5</span></a> shows shape functions for a linear triangle element. You will need to modify the function in our <code class="code docutils literal notranslate"><span class="pre">shapes.py</span></code> file to implement the triangular shape functions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#shape functions</span>
<span class="n">eta2</span> <span class="o">=</span> <span class="n">xi</span>
<span class="n">eta3</span> <span class="o">=</span> <span class="n">eta</span>
<span class="n">eta1</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">eta2</span><span class="o">-</span><span class="n">eta3</span>

<span class="n">N1</span> <span class="o">=</span> <span class="n">eta1</span>
<span class="n">N2</span> <span class="o">=</span> <span class="n">eta2</span>
<span class="n">N3</span> <span class="o">=</span> <span class="n">eta3</span>
</pre></div>
</div>
<p>Take this as a starting point and modify <code class="code docutils literal notranslate"><span class="pre">shapes.py</span></code> to return the correct three shape functions and the six derivatives!</p>
<p>Next we need to adapt our integration rule. Take these three integration points and weights.</p>
<table class="docutils align-default" id="id1">
<caption><span class="caption-number">Table 2 </span><span class="caption-text">Triangle integration</span><a class="headerlink" href="#id1" title="Link to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Integration point</p></th>
<th class="head"><p><span class="math notranslate nohighlight">\(\xi\)</span></p></th>
<th class="head"><p><span class="math notranslate nohighlight">\(\eta\)</span></p></th>
<th class="head"><p>weight</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(1\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\frac{1}{6}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\frac{1}{6}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\frac{1}{6}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(2\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\frac{2}{3}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\frac{1}{6}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\frac{1}{6}\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(3\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\frac{1}{6}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\frac{2}{3}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\frac{1}{6}\)</span></p></td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>There are, of course, many different elements and associated integration rules using different numbers of integration points in FEM. Have a look at the suggested books in <a class="reference internal" href="../general-info/course-details.html#course-details"><span class="std std-ref">Course details</span></a> .</p>
</div>
</section>
<section id="step-3-boundary-conditions">
<h2>Step 3: Boundary conditions<a class="headerlink" href="#step-3-boundary-conditions" title="Link to this heading"></a></h2>
<p>We were actually a bit “lazy” when we implemented the boundary conditions in the example above. Instead of coming up with a general solution, we identified the global node numbers on the boundaries assuming a structured quad mesh. Now we are using an unstructured triangle mesh and it is not so easy anymore to know which nodes are on the boundaries and should get boundary conditions. The “typical” way would be to use boundary markers in the mesh generation; here we use a different approach and use an ad-hoc search for the boundary nodes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># indices and values at top and bottom</span>
<span class="n">tol</span> <span class="o">=</span> <span class="mf">1e-3</span>
<span class="c1"># i_bot = np.where(abs(???) &lt; tol)[0] #bottom nodes</span>
<span class="c1"># i_top = np.where(abs(???) &lt; tol)[0] #top nodes</span>
</pre></div>
</div>
<p>Complete this and add the lines to the main code!</p>
<div class="admonition-boundary-conditions admonition">
<p class="admonition-title">Boundary conditions</p>
<p>Did you notice that we are not specifying boundary conditions for lateral boundaries? Still the code seems to work. Have a look at <a class="reference internal" href="../lecture4/fem_in_2d.html#equation-eq-fem-2d-weak-2">equation (119)</a> and think about which implicit assumption we are making about the line integral.</p>
</div>
</section>
<section id="step-4-post-processing-and-plotting">
<h2>Step 4: Post-processing and plotting<a class="headerlink" href="#step-4-post-processing-and-plotting" title="Link to this heading"></a></h2>
<p>Modify the post-processing code that computes the heat fluxes, so that it works for triangles. This should just involve setting a new local coordinates for the single integration points. Use <span class="math notranslate nohighlight">\(\xi=\frac{1}{3}\)</span> and  <span class="math notranslate nohighlight">\(\eta=\frac{1}{3}\)</span>, which is the center of each triangle.</p>
<p>Now we just need to plot! Thankfully python makes it easy for us and we can use the functions <code class="code docutils literal notranslate"><span class="pre">triplot</span></code> and <code class="code docutils literal notranslate"><span class="pre">tricontourf</span></code> to plot the unstructured data.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># plotting</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">triplot</span><span class="p">(</span><span class="n">GCOORD</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">GCOORD</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">EL2NOD</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">cp</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">tricontourf</span><span class="p">(</span><span class="n">GCOORD</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">GCOORD</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">EL2NOD</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gist_yarg&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cp</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">Ec_x</span><span class="p">,</span> <span class="n">Ec_y</span><span class="p">,</span> <span class="n">Q_x</span><span class="p">,</span> <span class="n">Q_y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">Q_x</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">Q_y</span><span class="p">)),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;hot&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Temperature with heat flow vectors&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-center" id="fig-fem-triangle-dif-f" style="width: 80%">
<img alt="../_images/triangle_fem_diffusion.png" src="../_images/triangle_fem_diffusion.png" />
<figcaption>
<p><span class="caption-number">Fig. 17 </span><span class="caption-text">2-D diffusion on unstructured mesh.</span><a class="headerlink" href="#fig-fem-triangle-dif-f" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="overview.html" class="btn btn-neutral float-left" title="Overview" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../lecture6/overview.html" class="btn btn-neutral float-right" title="Overview" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Lars Ruepke and Zhikui Guo.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
      
        <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
          <span class="rst-current-version" data-toggle="rst-current-version">
            <span class="fa fa-book"> Finite Element Modeling in Geodynamics</span>
            v: latest
            <span class="fa fa-caret-down"></span>
          </span>
          <div class="rst-other-versions">
            <dl>
              
                
                <dd><a href="https://lruepke.github.io/FEM_lecture/downloads/LectureNote.pdf">latest</a></dd>
                
                <dd><a href="#/LectureNote.pdf">2.0</a></dd>
                
              
          </div>
        </div>
      
    

</body>
</html>