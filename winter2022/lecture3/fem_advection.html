
<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FEM and advection problems &mdash; Finite Element Modeling in Geodynamics  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../_static/style.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/tabs.js?v=3ee01567"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Script for calculating steady state 1D advection-diffusion using FDM methods" href="jupyter/fdm_adv_diff.html" />
    <link rel="prev" title="Numerical 1-D FEM solution of the heat diffusion equation" href="jupyter/fem_1d_numerical.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Finite Element Modeling in Geodynamics
              <img src="../_static/triangle_fem_cover.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
    
              <p class="caption" role="heading"><span class="caption-text">Course information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../general-info/course-details.html">Course details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general-info/installation.html">Installation guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Lecture 1</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../lecture1/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture1/fdm_intro.html">Introduction: The Finite Differences Method (FDM)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture1/example_1.html">Example 1: Cooling dike</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture1/example_2.html">Example 2: Cooling dike - implicit version</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture1/example_3.html">Example 3: Periodic variations in seafloor temperature</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture1/fdm_advection.html">Transport problems with FDM</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Lecture 2</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../lecture2/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture2/mwr_intro.html">Introduction: Method of Weighted Residuals (MWR)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture2/mwr_examples.html">MWR solutions of the steady advection-diffusion equation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture2/excercises.html">Excercises</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Lecture 3</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="fem_intro.html">Introduction Finite Element Method (FEM)</a></li>
<li class="toctree-l1"><a class="reference internal" href="fem_intro.html#fem-implementation">FEM implementation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">FEM and advection problems</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#d-finite-differences-solutions">1D Finite Differences Solutions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="jupyter/fdm_adv_diff.html">Script for calculating steady state 1D advection-diffusion using FDM methods</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#d-finite-element-solutions">1D Finite Element Solutions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="jupyter/fem_1d_symbolic_adv.html">Symbolic derivation of 1-D FEM stiffness matrix</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Lecture 4</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../lecture4/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture4/fem_in_2d.html">2-D FEM - elliptic problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture4/fem_in_2d.html#implementation">Implementation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Lecture 5</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../lecture5/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture5/FEM_triangles.html">Triangles: unstructured meshes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture5/FEM_triangles.html#excercise">Excercise</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Lecture 6</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../lecture6/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture6/transient_problems.html">Transient heat diffusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture6/turing_coupled_problem.html">Coupled diffusion problems</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../refs.html">References</a></li>
</ul>


    
        <p class="caption">
            <span class="caption-text">Getting help</span>
        </p>
        <ul>
            
                <li class="toctree-l1"><a href="https://lruepke.github.io/HTF_lecture/imprint/"><i class="fa fa-stamp"></i> Imprint</a></li>
            
                <li class="toctree-l1"><a href="mailto:lruepke@geomar.de"><i class="fa fa-envelope fa-fw"></i> Prof. Lars Ruepke</a></li>
            
                <li class="toctree-l1"><a href="mailto:zguo@geomar.de"><i class="fa fa-envelope fa-fw"></i> Dr. Zhikui Guo</a></li>
            
                <li class="toctree-l1"><a href="https://lruepke.github.io/FEM_lecture/"><i class="fa fa-home fa-fw"></i> Public site</a></li>
            
                <li class="toctree-l1"><a href="https://lms.uni-kiel.de/url/RepositoryEntry/3664576582"><i class="fa fa-home fa-fw"></i> University site</a></li>
            
        </ul>
    

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Finite Element Modeling in Geodynamics</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">FEM and advection problems</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/lruepke/HTF_lecture/blob/main//source/lecture3/fem_advection.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="fem-and-advection-problems">
<h1>FEM and advection problems<a class="headerlink" href="#fem-and-advection-problems" title="Link to this heading"></a></h1>
<p>In one of the introductory chapters, we had looked into transport problems and how to solve them using FDM. Today we will take this a bit further in order to understand why certain solutions did not work and why finite elements have their own problems for advection. For this purpose, we will again use the standard 1-D steady-state advection diffusion equation:</p>
<div class="math notranslate nohighlight" id="equation-eq-fem-adv-diff">
<span class="eqno">(106)<a class="headerlink" href="#equation-eq-fem-adv-diff" title="Link to this equation"></a></span>\[c \frac{\partial }{\partial x}T - \frac{\partial}{\partial x}k \frac{\partial T}{\partial x} = 0,\]</div>
<p>where <span class="math notranslate nohighlight">\(c\)</span> is velocity, <span class="math notranslate nohighlight">\(T\)</span> temperature, and <span class="math notranslate nohighlight">\(k\)</span> thermal conductivity.</p>
<section id="d-finite-differences-solutions">
<h2>1D Finite Differences Solutions<a class="headerlink" href="#d-finite-differences-solutions" title="Link to this heading"></a></h2>
<p>Let’s have a look at the two different FD solutions that we know alreay: FTCS and upwind. We can write them in condensed form. The FTCS looks like this:</p>
<div class="math notranslate nohighlight" id="equation-eq-adv-diff-ftcs">
<span class="eqno">(107)<a class="headerlink" href="#equation-eq-adv-diff-ftcs" title="Link to this equation"></a></span>\[\begin{split}\begin{align}
\begin{split}
\frac{c}{\Delta x}
\begin{bmatrix}
-\frac{1}{2} &amp; 0 &amp;  -\frac{1}{2}
\end{bmatrix} \begin{bmatrix} T_{i-1} \\ T_{i} \\ T_{i+1} \end{bmatrix} -\frac{k}{\Delta x^2} \begin{bmatrix}
1 &amp; -2 &amp;  1 \end{bmatrix}\begin{bmatrix} T_{i-1} \\ T_{i} \\ T_{i+1} \end{bmatrix} &amp;= 0 \\
\begin{bmatrix}
-\left(\frac{c}{2\Delta x} + \frac{k}{\Delta x^2} \right) &amp; \frac{2k}{\Delta x^2} &amp;  - \left( - \frac{c}{2 \Delta x} + \frac{k}{\Delta x^2} \right) \end{bmatrix} \begin{bmatrix} T_{i-1} \\ T_{i} \\ T_{i+1} \end{bmatrix}  &amp;= 0 \\
\end{split}
\end{align}\end{split}\]</div>
<p>Do you notice the asymmetry?</p>
<p>Let’s do the same thing for the upwind case:</p>
<div class="math notranslate nohighlight" id="equation-eq-adv-diff-uw">
<span class="eqno">(108)<a class="headerlink" href="#equation-eq-adv-diff-uw" title="Link to this equation"></a></span>\[\begin{split}\begin{align}
\begin{split}
\frac{c}{\Delta x}
\begin{bmatrix}
-1 &amp; 1 &amp;  0
\end{bmatrix} \begin{bmatrix} T_{i-1} \\ T_{i} \\ T_{i+1} \end{bmatrix} -\frac{k}{\Delta x^2} \begin{bmatrix}
1 &amp; -2 &amp;  1 \end{bmatrix}\begin{bmatrix} T_{i-1} \\ T_{i} \\ T_{i+1} \end{bmatrix} &amp;= 0 \\
\begin{bmatrix}
-\left(\frac{c}{\Delta x} + \frac{k}{\Delta x^2} \right) &amp; \left( \frac{c}{\Delta x} + \frac{2k}{\Delta x^2} \right) &amp;  - \frac{k}{\Delta x^2}  \end{bmatrix} \begin{bmatrix} T_{i-1} \\ T_{i} \\ T_{i+1} \end{bmatrix}  &amp;= 0 \\
\end{split}
\end{align}\end{split}\]</div>
<p>Again asymetric. Let’s quickly program those two solutions!</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="jupyter/fdm_adv_diff.html">Script for calculating steady state 1D advection-diffusion using FDM methods</a></li>
</ul>
</div>
<p>Explore the solution for different pairs of Peclet numbers and c/k ratios. What is the main difference between the upwind and FTCS solution? What kind of numerical diffusion is happening? What’s the sign of the numerical diffusion? Is negative diffusion physically possible, or a source of trouble?</p>
</section>
<section id="d-finite-element-solutions">
<h2>1D Finite Element Solutions<a class="headerlink" href="#d-finite-element-solutions" title="Link to this heading"></a></h2>
<p>Let’s see how a simple finite element solution looks like. This would be the stiffness matrix for a single element using linear shape functions:</p>
<div class="math notranslate nohighlight" id="equation-eq-fem-1d-single-element-adv">
<span class="eqno">(109)<a class="headerlink" href="#equation-eq-fem-1d-single-element-adv" title="Link to this equation"></a></span>\[\begin{split}\begin{bmatrix}
\int_{X_e} \left ( N_1 c \frac{\partial N_1}{dx} + \frac{\partial N_1}{\partial x}k\frac{\partial N_1}{\partial x} \right) dx &amp;
\int_{X_e} \left (  N_1 c \frac{\partial N_2}{dx} + \frac{\partial N_1}{\partial x}k\frac{\partial N_2}{\partial x} \right) dx \\
\int_{X_e} \left ( N_2 c \frac{\partial N_1}{dx} + \frac{\partial N_2}{\partial x}k\frac{\partial N_1}{\partial x} \right )dx &amp;
\int_{X_e} \left ( N_2 c \frac{\partial N_2}{dx} + \frac{\partial N_2}{\partial x}k\frac{\partial N_2}{\partial x} \right )dx
\end{bmatrix}
\begin{bmatrix}
T_1 \\
T_2
\end{bmatrix}=0\end{split}\]</div>
<p>Notice how the sign changed on the diffusion term after partial integration. Again, we get a <span class="math notranslate nohighlight">\(2x2\)</span> stiffness matrix for every element. The node numbering is again local; node number 1 is the first node of an element k and has the global node number k, while node number 2 is the second node of the element and has the global node number k+1!</p>
<p>We can do the integration using symbolic math. We use again our standard 1D linear interpolation functions; just changed to use <span class="math notranslate nohighlight">\(\bar{x}\)</span> as our variable describing distance along the element to make the integration easier.</p>
<div class="math notranslate nohighlight" id="equation-eq-fem-1d-shape-elem-adv">
<span class="eqno">(110)<a class="headerlink" href="#equation-eq-fem-1d-shape-elem-adv" title="Link to this equation"></a></span>\[\begin{split}\begin{align}
\begin{split}
N_i(x) = 1 - \frac{x-x_i}{x_{i+1} - x_i} = 1 - \frac{x-x_i}{\Delta x} &amp;= 1 - \frac{\bar{x}}{\Delta x}\\
N_{i+1}(x) = \frac{x-x_i}{x_{i+1} - x_i} = \frac{x-x_i}{\Delta x}&amp; = \frac{\bar{x}}{\Delta x}\\
\end{split}
\end{align}\end{split}\]</div>
<p>Follow the implementation steps in the notebook!</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="jupyter/fem_1d_symbolic_adv.html">Symbolic derivation of 1-D FEM stiffness matrix</a></li>
</ul>
</div>
<p>What we find is that the element stiffness matrix of a single element looks like this:</p>
<div class="math notranslate nohighlight" id="equation-eq-fem-1d-int-ae-adv">
<span class="eqno">(111)<a class="headerlink" href="#equation-eq-fem-1d-int-ae-adv" title="Link to this equation"></a></span>\[\begin{split}Ael =
\begin{bmatrix}
-\frac{c}{2} + \frac{k}{\Delta x} &amp;
\frac{c}{2} -\frac{k}{\Delta x} \\
-\frac{c}{2} -\frac{k}{\Delta x} &amp;
\frac{c}{2} + \frac{k}{\Delta x}
\end{bmatrix}\end{split}\]</div>
<p>If we assemble it into the global stiffness matrix assuming two elements, we get this equation:</p>
<div class="math notranslate nohighlight" id="equation-eq-fem-1d-int-ag-adv">
<span class="eqno">(112)<a class="headerlink" href="#equation-eq-fem-1d-int-ag-adv" title="Link to this equation"></a></span>\[\begin{split}A =
\begin{bmatrix}
-\frac{c}{2} + \frac{k}{\Delta x}  &amp; \frac{c}{2} -\frac{k}{\Delta x} &amp; 0 \\
-\frac{c}{2} -\frac{k}{\Delta x} &amp; \frac{2k}{\Delta x} &amp; \frac{c}{2} -\frac{k}{\Delta x} \\
0 &amp; -\frac{c}{2} -\frac{k}{\Delta x} &amp; \frac{c}{2} + \frac{k}{\Delta x} \\
\end{bmatrix}
\begin{bmatrix}
T_{1}\\
T_2\\
T_{3}\\
\end{bmatrix}=0\end{split}\]</div>
<p>And if we spell this out for the internal node <span class="math notranslate nohighlight">\(2\)</span>, we get:</p>
<div class="math notranslate nohighlight" id="equation-eq-fem-1d-int-ag-adv-node">
<span class="eqno">(113)<a class="headerlink" href="#equation-eq-fem-1d-int-ag-adv-node" title="Link to this equation"></a></span>\[\begin{split}\begin{bmatrix}
-\frac{c}{2} -\frac{k}{\Delta x} &amp; \frac{2k}{\Delta x} &amp; \frac{c}{2} -\frac{k}{\Delta x}
\end{bmatrix}
\begin{bmatrix}
T_{1}\\
T_2\\
T_{3}\\
\end{bmatrix}=0,\end{split}\]</div>
<p>which we can compare to the FTCS solution:</p>
<div class="math notranslate nohighlight" id="equation-eq-fem-1d-int-ag-adv-node-ftcs">
<span class="eqno">(114)<a class="headerlink" href="#equation-eq-fem-1d-int-ag-adv-node-ftcs" title="Link to this equation"></a></span>\[\begin{split}\begin{bmatrix}
-\left(\frac{c}{2\Delta x} + \frac{k}{\Delta x^2} \right) &amp; \frac{2k}{\Delta x^2} &amp;  - \left( - \frac{c}{2 \Delta x} + \frac{k}{\Delta x^2} \right) \end{bmatrix} \begin{bmatrix} T_{i-1} \\ T_{i} \\ T_{i+1} \end{bmatrix}  &amp;= 0\end{split}\]</div>
<p>The two solutions are the same - safe for a constant factor <span class="math notranslate nohighlight">\(\Delta x\)</span>, which drops out because it also shows up on the RHS (if we had one)! This implies that FE solutions also have an intrinsinc negative diffusion component, which makes them unstable. A popular way to stabilize them is to use the Streamline Upwind Petrov Galerkin (SUPG) method, which modifies the weighting functions so that a little bit of numerical diffusion is added in the direction of flow.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="jupyter/fem_1d_numerical.html" class="btn btn-neutral float-left" title="Numerical 1-D FEM solution of the heat diffusion equation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="jupyter/fdm_adv_diff.html" class="btn btn-neutral float-right" title="Script for calculating steady state 1D advection-diffusion using FDM methods" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Lars Ruepke and Zhikui Guo.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
      
        <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
          <span class="rst-current-version" data-toggle="rst-current-version">
            <span class="fa fa-book"> Finite Element Modeling in Geodynamics</span>
            v: latest
            <span class="fa fa-caret-down"></span>
          </span>
          <div class="rst-other-versions">
            <dl>
              
                
                <dd><a href="https://lruepke.github.io/FEM_lecture/downloads/LectureNote.pdf">latest</a></dd>
                
                <dd><a href="#/LectureNote.pdf">2.0</a></dd>
                
              
          </div>
        </div>
      
    

</body>
</html>