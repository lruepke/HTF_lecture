
<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2-D FEM - elliptic problems &mdash; Finite Element Modeling in Geodynamics  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../_static/style.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/tabs.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="2-D FEM coordinate and connectivity matrices" href="jupyter/2d_fem_connectivity.html" />
    <link rel="prev" title="Overview" href="overview.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Finite Element Modeling in Geodynamics
            <img src="../_static/triangle_fem_cover.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
    
              <p class="caption" role="heading"><span class="caption-text">Course information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../general-info/course-details.html">Course details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general-info/installation.html">Installation guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Lecture 1</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../lecture1/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture1/fdm_intro.html">Introduction: The Finite Differences Method (FDM)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture1/example_1.html">Example 1: Cooling dike</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture1/example_2.html">Example 2: Cooling dike - implicit version</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture1/example_3.html">Example 3: Periodic variations in seafloor temperature</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture1/fdm_advection.html">Transport problems with FDM</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Lecture 2</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../lecture2/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture2/mwr_intro.html">Introduction: Method of Weighted Residuals (MWR)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture2/mwr_examples.html">MWR solutions of the steady advection-diffusion equation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture2/excercises.html">Excercises</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Lecture 3</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../lecture3/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture3/fem_intro.html">Introduction Finite Element Method (FEM)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture3/fem_intro.html#fem-implementation">FEM implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture3/fem_advection.html">FEM and advection problems</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Lecture 4</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">2-D FEM - elliptic problems</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#governing-equation-strong-form">Governing equation - strong form</a></li>
<li class="toctree-l2"><a class="reference internal" href="#d-shape-functions">2-D shape functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#weak-form">Weak form</a></li>
<li class="toctree-l2"><a class="reference internal" href="#element-connectivity">Element connectivity</a></li>
<li class="toctree-l2"><a class="reference internal" href="#numerical-integration">Numerical integration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#gauss-points">Gauss points</a></li>
<li class="toctree-l3"><a class="reference internal" href="#isoparametric-elements">Isoparametric elements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#jacobian-matrix">Jacobian matrix</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#excercises">Excercises</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#fem-mesh">FEM mesh</a><ul>
<li class="toctree-l4"><a class="reference internal" href="jupyter/2d_fem_connectivity.html">2-D FEM coordinate and connectivity matrices</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#shape-functions">Shape functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="jupyter/FEM_2d_shapes_excercise.html">2-D FEM shape functions</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#implementation">Implementation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#python-code">Python code</a></li>
<li class="toctree-l2"><a class="reference internal" href="#jacobian">Jacobian:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#global-derivatives-of-shape-functions">Global derivatives of shape functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#element-stiffness-matrix">Element stiffness matrix</a></li>
<li class="toctree-l2"><a class="reference internal" href="#boundary-conditions">Boundary conditions</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Lecture 5</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../lecture5/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture5/FEM_triangles.html">Triangles: unstructured meshes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture5/FEM_triangles.html#excercise">Excercise</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Lecture 6</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../lecture6/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture6/transient_problems.html">Transient heat diffusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lecture6/turing_coupled_problem.html">Coupled diffusion problems</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../refs.html">References</a></li>
</ul>


    
        <p class="caption">
            <span class="caption-text">Getting help</span>
        </p>
        <ul>
            
                <li class="toctree-l1"><a href="https://lruepke.github.io/HTF_lecture/imprint/"><i class="fa fa-stamp"></i> Imprint</a></li>
            
                <li class="toctree-l1"><a href="mailto:lruepke@geomar.de"><i class="fa fa-envelope fa-fw"></i> Prof. Lars Ruepke</a></li>
            
                <li class="toctree-l1"><a href="mailto:zguo@geomar.de"><i class="fa fa-envelope fa-fw"></i> Dr. Zhikui Guo</a></li>
            
                <li class="toctree-l1"><a href="https://lruepke.github.io/FEM_lecture/"><i class="fa fa-home fa-fw"></i> Public site</a></li>
            
                <li class="toctree-l1"><a href="https://lms.uni-kiel.de/url/RepositoryEntry/3664576582"><i class="fa fa-home fa-fw"></i> University site</a></li>
            
        </ul>
    

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Finite Element Modeling in Geodynamics</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>2-D FEM - elliptic problems</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/lruepke/HTF_lecture/blob/main//source/lecture4/fem_in_2d.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="d-fem-elliptic-problems">
<h1>2-D FEM - elliptic problems<a class="headerlink" href="#d-fem-elliptic-problems" title="Permalink to this heading"></a></h1>
<p>Let’s move on to 2D! We will again use our steady-state heat diffusion equation as an example and will follow basically the same steps as during the 1-D example.</p>
<section id="governing-equation-strong-form">
<h2>Governing equation - strong form<a class="headerlink" href="#governing-equation-strong-form" title="Permalink to this heading"></a></h2>
<p>The strong form looks like this, we have just added the second dimension.</p>
<div class="math notranslate nohighlight" id="equation-eq-fem-2d-strong">
<span class="eqno">(115)<a class="headerlink" href="#equation-eq-fem-2d-strong" title="Permalink to this equation"></a></span>\[\frac{\partial}{\partial x}k\frac{\partial T_{ex}}{\partial x} + \frac{\partial}{\partial y}k\frac{\partial T_{ex}}{\partial y} =0.\]</div>
</section>
<section id="d-shape-functions">
<h2>2-D shape functions<a class="headerlink" href="#d-shape-functions" title="Permalink to this heading"></a></h2>
<p>We now use 2-D shape functions in our approximate solution:</p>
<div class="math notranslate nohighlight" id="equation-eq-fem-aprox-funcion-2d">
<span class="eqno">(116)<a class="headerlink" href="#equation-eq-fem-aprox-funcion-2d" title="Permalink to this equation"></a></span>\[T_{ex} \cong \tilde{T}= \sum_{j=1}^{n} N_j(x,y) T_j = N_j T_j,\]</div>
<p>where the shape functions <span class="math notranslate nohighlight">\(N_j(x,y)\)</span> are now function of both spatial dimensions. An example of a 2-D FEM mesh and associated shape functions are shown in <a class="reference internal" href="#fig-shapefunc-2d-linear"><span class="std std-numref">Fig. 5</span></a>. Note that the structured quad mesh and the bi-linear shape functions are just one possibility of using the FEM in 2-D. There are many other possibility, like unstructured triangle meshes and higher order shape functions.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Never forget that the shape functions <span class="math notranslate nohighlight">\(N(x,y)\)</span> are defined over the entire modeling domain in global coordinates. We will just evaluate them per element using local coordinates.</p>
</div>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--1-input--1" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--1">Four‐Node Bilinear Quadrilateral</label><div class="tab-content docutils container">
<figure class="align-center" id="fig-shapefunc-2d-linear">
<img alt="../_images/shapeFunction_2D_Q1.svg" src="../_images/shapeFunction_2D_Q1.svg" /><figcaption>
<p><span class="caption-number">Fig. 5 </span><span class="caption-text">Example of 2D linear finite element shape functions</span><a class="headerlink" href="#fig-shapefunc-2d-linear" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</div>
<input class="tab-input" id="tab-set--1-input--2" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--2">Nine‐Node Biquadratic Quadrilateral</label><div class="tab-content docutils container">
<figure class="align-center" id="fig-shapefunc-2d-quad-q2">
<img alt="../_images/shapeFunction_2D_Q2.svg" src="../_images/shapeFunction_2D_Q2.svg" /><figcaption>
<p><span class="caption-number">Fig. 6 </span><span class="caption-text">Example of 2D finite element shape functions</span><a class="headerlink" href="#fig-shapefunc-2d-quad-q2" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</div>
</div>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--0-input--1" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--1">Three‐Node Triangle Element</label><div class="tab-content docutils container">
<figure class="align-center" id="fig-shapefunc-2d-tri-q1">
<img alt="../_images/shapeFunction_2D_triangle_Q1.svg" src="../_images/shapeFunction_2D_triangle_Q1.svg" /><figcaption>
<p><span class="caption-number">Fig. 7 </span><span class="caption-text">Example of 2D finite element shape functions</span><a class="headerlink" href="#fig-shapefunc-2d-tri-q1" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</div>
<input class="tab-input" id="tab-set--0-input--2" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--2">Six‐Node Quadratic Triangle</label><div class="tab-content docutils container">
<figure class="align-center" id="fig-shapefunc-2d-tri-q2">
<img alt="../_images/shapeFunction_2D_triangle_Q2.svg" src="../_images/shapeFunction_2D_triangle_Q2.svg" /><figcaption>
<p><span class="caption-number">Fig. 8 </span><span class="caption-text">Example of 2D finite element shape functions</span><a class="headerlink" href="#fig-shapefunc-2d-tri-q2" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</div>
<input class="tab-input" id="tab-set--0-input--3" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--3">Ten‐Node Qubic Triangle</label><div class="tab-content docutils container">
<figure class="align-center" id="fig-shapefunc-2d-tri-q3">
<img alt="../_images/shapeFunction_2D_triangle_Q3.svg" src="../_images/shapeFunction_2D_triangle_Q3.svg" /><figcaption>
<p><span class="caption-number">Fig. 9 </span><span class="caption-text">Example of 2D finite element shape functions</span><a class="headerlink" href="#fig-shapefunc-2d-tri-q3" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</div>
</div>
<p>Note that the 2-D shape functions still sum to <span class="math notranslate nohighlight">\(1\)</span> everywhere:</p>
<div class="math notranslate nohighlight" id="equation-eq-fem-aprox-funcion-2d-2">
<span class="eqno">(117)<a class="headerlink" href="#equation-eq-fem-aprox-funcion-2d-2" title="Permalink to this equation"></a></span>\[\sum_{j=1}^{n} N_j(x,y)  = 1.\]</div>
</section>
<section id="weak-form">
<h2>Weak form<a class="headerlink" href="#weak-form" title="Permalink to this heading"></a></h2>
<p>We proceed by substituting <a class="reference internal" href="#equation-eq-fem-aprox-funcion-2d">equation (116)</a> into <a class="reference internal" href="#equation-eq-fem-2d-strong">equation (115)</a> and by using the Galerkin method we get:</p>
<div class="math notranslate nohighlight" id="equation-eq-fem-2d-weak">
<span class="eqno">(118)<a class="headerlink" href="#equation-eq-fem-2d-weak" title="Permalink to this equation"></a></span>\[\int_\Omega N_i \frac{\partial}{\partial x}k\frac{\partial N_j T_j }{\partial x} + N_i \frac{\partial}{\partial y}k\frac{\partial N_j T_j }{\partial y} d\Omega=0\ \ \ \ \ \ \ i=1,2,...,n\]</div>
<p>We do the integration by parts and obtain:</p>
<div class="math notranslate nohighlight" id="equation-eq-fem-2d-weak-2">
<span class="eqno">(119)<a class="headerlink" href="#equation-eq-fem-2d-weak-2" title="Permalink to this equation"></a></span>\[\begin{split}\begin{align}
\begin{split}
-\int_\Omega \left ( \frac{\partial N_i}{\partial x}k\frac{\partial N_j T_j }{\partial x} + \frac{\partial N_i}{\partial y}k\frac{\partial N_j T_j }{\partial y} d\Omega \right ) &amp;+ \oint_{\Gamma} \left ( N_ik\frac{\partial N_j T_j }{\partial x}  +  N_ik\frac{\partial N_j T_j }{\partial y} \right ) d\Gamma    =0\ \ \ \ \ \ \ i=1,2,...,n\\
\Rightarrow \\
+\int_\Omega \left ( \frac{\partial N_i}{\partial x}k\frac{\partial N_j}{\partial x} + \frac{\partial N_i}{\partial y}k\frac{\partial N_j}{\partial y} T_j d\Omega \right ) &amp;+ \oint_{\Gamma} N_i \vec{q}\vec{n}  d\Gamma    =0\ \ \ \ \ \ \ i=1,2,...,n\\
\end{split}
\end{align}\end{split}\]</div>
<p>Note how the signs flipped during integration by parts and by substituting <span class="math notranslate nohighlight">\(\vec{q}=-k\nabla T\)</span>. The line integral has a clear physical meaning now, it’s the heat flow in and out of the modeling domain.</p>
<p>We go on and split the modeling domain into finite elements and the first integral turns into a sum over those elements. The line integral is again obmitted for the moment.</p>
<div class="math notranslate nohighlight" id="equation-eq-fem-2d-weak-3">
<span class="eqno">(120)<a class="headerlink" href="#equation-eq-fem-2d-weak-3" title="Permalink to this equation"></a></span>\[\begin{split}\begin{align}
\begin{split}
+\int_\Omega \left ( \frac{\partial N_i}{\partial x}k\frac{\partial N_j}{\partial x} + \frac{\partial N_i}{\partial y}k\frac{\partial N_j}{\partial y} T_j \right ) d\Omega   &amp;=0\ \ \ \ \ \ \ i=1,2,...,n\\
\Rightarrow \\
+\int_\Omega \left ( \frac{\partial N_i}{\partial x}k\frac{\partial N_j}{\partial x} + \frac{\partial N_i}{\partial y}k\frac{\partial N_j}{\partial y} T_j \right ) d\Omega   &amp;= \sum_{Elements} \int_{\Omega_{e}} \left ( \frac{\partial N_i}{\partial x}k\frac{\partial N_j}{\partial x} + \frac{\partial N_i}{\partial y}k\frac{\partial N_j}{\partial y}  \right ) T_j d\Omega_{e} =0\ \ \ \ \ \ \ i=1,2,...,n\\
\end{split}
\end{align}\end{split}\]</div>
</section>
<section id="element-connectivity">
<h2>Element connectivity<a class="headerlink" href="#element-connectivity" title="Permalink to this heading"></a></h2>
<p>The basic concept of the finite element method is to solve/assemble the system of equations, for e.g. heat diffusion, on each element and add all element contributions together to obtain the global matrix equation.
Every element has an element number and a certain number of nodes. We will initially use quadratic elements with four nodes.</p>
<p>For a FEM mesh with bi-linear quad elements, we will need two matrices: a matrix we will call CGCOORD that contains the global coordinates of each grid point (it therefore has the size [nnod,2], where 2 is the number of dimensions (x,y) and nnod is the total number of nodes) and a matris so we call ELEM2NODE, which contains for each element the indices of the four nodes that belong to it (it therefore has the size [nel, nnodel], where nel is the total number of elements and nnodel is the number of nodes per element). See <a class="reference internal" href="#fig-mesh-2d-structured"><span class="std std-numref">Fig. 10</span></a> for more details. We had already used these matrices in 1-D but now their meanings become clear.</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--2-input--1" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--1">Structured mesh 1</label><div class="tab-content docutils container">
<figure class="align-center" id="fig-mesh-2d-structured">
<img alt="../_images/mesh2D_structured.svg" src="../_images/mesh2D_structured.svg" /><figcaption>
<p><span class="caption-number">Fig. 10 </span><span class="caption-text">Structured mesh example of 2D finite element</span><a class="headerlink" href="#fig-mesh-2d-structured" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</div>
<input class="tab-input" id="tab-set--2-input--2" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--2">Structured mesh 2</label><div class="tab-content docutils container">
<figure class="align-center" id="fig-mesh-2d-structured-usi">
<img alt="../_images/mesh2D_structured_usi.svg" src="../_images/mesh2D_structured_usi.svg" /><figcaption>
<p><span class="caption-number">Fig. 11 </span><span class="caption-text"><a class="reference download internal" download="" href="../_downloads/06175368e0da1f39153a96c18d7cef8b/structure.msh"><code class="xref download docutils literal notranslate"><span class="pre">Structured</span> <span class="pre">mesh</span></code></a> example of 2D finite element</span><a class="headerlink" href="#fig-mesh-2d-structured-usi" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</div>
<input class="tab-input" id="tab-set--2-input--3" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--3">Unstructured mesh</label><div class="tab-content docutils container">
<figure class="align-center" id="fig-mesh-2d-unstructured">
<img alt="../_images/mesh2D_unstructured.svg" src="../_images/mesh2D_unstructured.svg" /><figcaption>
<p><span class="caption-number">Fig. 12 </span><span class="caption-text"><a class="reference download internal" download="" href="../_downloads/4c3ddbe4b1640134939545f76313c427/unstructure.msh"><code class="xref download docutils literal notranslate"><span class="pre">Unstructured</span> <span class="pre">mesh</span></code></a> example of 2D finite element</span><a class="headerlink" href="#fig-mesh-2d-unstructured" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</div>
</div>
<p>We will use a connectivity as shown in <a class="reference internal" href="#fig-matrix-2d-structured"><span class="std std-numref">Fig. 13</span></a>. Element 0 has, for example, the global nodes 0, 1, 6, 5. Note that the local element numbering is always counterclockwise (in this class). It therefore contributes to the calculations of those four temperatures. The element stiffness matrix will now be [4,4]. The contribution of all elements is added/assembled into the glob</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--3-input--1" name="tab-set--3" type="radio"><label class="tab-label" for="tab-set--3-input--1">Structured mesh 1</label><div class="tab-content docutils container">
<figure class="align-center" id="fig-matrix-2d-structured">
<img alt="../_images/Matrix2D_structured.svg" src="../_images/Matrix2D_structured.svg" /><figcaption>
<p><span class="caption-number">Fig. 13 </span><span class="caption-text">Connectivity example of 2D finite element with structured mesh</span><a class="headerlink" href="#fig-matrix-2d-structured" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</div>
<input class="tab-input" id="tab-set--3-input--2" name="tab-set--3" type="radio"><label class="tab-label" for="tab-set--3-input--2">Structured mesh 2</label><div class="tab-content docutils container">
<figure class="align-center" id="fig-matrix-2d-structured-usi">
<img alt="../_images/Matrix2D_structured_usi.svg" src="../_images/Matrix2D_structured_usi.svg" /><figcaption>
<p><span class="caption-number">Fig. 14 </span><span class="caption-text">Connectivity example of 2D finite element with structured mesh</span><a class="headerlink" href="#fig-matrix-2d-structured-usi" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</div>
<input class="tab-input" id="tab-set--3-input--3" name="tab-set--3" type="radio"><label class="tab-label" for="tab-set--3-input--3">Unstructured mesh</label><div class="tab-content docutils container">
<figure class="align-center" id="fig-matrix-2d-unstructured">
<img alt="../_images/Matrix2D_unstructured.svg" src="../_images/Matrix2D_unstructured.svg" /><figcaption>
<p><span class="caption-number">Fig. 15 </span><span class="caption-text">Connectivity example of 2D finite element with unstructured mesh</span><a class="headerlink" href="#fig-matrix-2d-unstructured" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</div>
</div>
</section>
<section id="numerical-integration">
<h2>Numerical integration<a class="headerlink" href="#numerical-integration" title="Permalink to this heading"></a></h2>
<p>The next step is to learn how we can integrate the element stiffness matrix. We have seen that the general finite element form, called weak form, of the heat diffusion equation can be written as (with boundary terms omitted):</p>
<div class="math notranslate nohighlight" id="equation-eq-fem-2d-weak-num-int">
<span class="eqno">(121)<a class="headerlink" href="#equation-eq-fem-2d-weak-num-int" title="Permalink to this equation"></a></span>\[\int_\Omega \left ( \frac{\partial N_i}{\partial x}k\frac{\partial N_j}{\partial x} + \frac{\partial N_i}{\partial y}k\frac{\partial N_j}{\partial y} T_j \right ) d\Omega   = \sum_{Elements} \int_{\Omega_{e}} \left ( \frac{\partial N_i}{\partial x}k\frac{\partial N_j}{\partial x} + \frac{\partial N_i}{\partial y}k\frac{\partial N_j}{\partial y}  \right ) T_j d\Omega_{e} =0\ \ \ \ \ \ \ i=1,2,...,n\]</div>
<p>The main problem with solving <a class="reference internal" href="#equation-eq-fem-2d-weak-num-int">equation (121)</a> is that the integral may be very difficult to evaluate. In finite elements we can use elements of very different geometries to mesh complex objects, which makes the 2-D integrals very hard to solve. We will therefore use numerical integration techniques like Gauss-Legendre quadrature. The problem is (or good thing  as we will see later) that basically all quadrature rules (for quads) apply to rectangular domains that are 2x2 in size and have a local coordinate system <span class="math notranslate nohighlight">\((−1 \leq (\xi,\eta) \leq 1)\)</span>. The integration of a function over a 2d domain can than be expressed as:</p>
<div class="math notranslate nohighlight" id="equation-eq-num-int-1">
<span class="eqno">(122)<a class="headerlink" href="#equation-eq-num-int-1" title="Permalink to this equation"></a></span>\[\int_{\hat{\Omega}} F(\xi,\eta) d\xi d\eta = \int_{-1}^{1}\int_{-1}^{1}F(\xi,\eta)d\xi d\eta = \sum_{I=1}^{M} \sum_{J=1}^{N} F(\xi_I,\eta_J)W_I W_J = \sum_{ip}F(\xi_{ip},\eta_{ip})W_{ip},\]</div>
<p>where M and N denote the number of Gauss points, <span class="math notranslate nohighlight">\((\xi,\eta)\)</span> and <span class="math notranslate nohighlight">\(W_J\)</span> denote the corresponding Gauss weights. The selection of the number of Gauss points is based on the formula <span class="math notranslate nohighlight">\(N=int[(p+1)/2]+1\)</span>, where p the polynomial degree to which the integrand is approximated. We will use linear shape functions so that we have 2 Gauss points (in every direction). In this case the local coordinates are <span class="math notranslate nohighlight">\(\pm0.5773502692\)</span> and the weights are all <span class="math notranslate nohighlight">\(1\)</span>.</p>
<section id="gauss-points">
<h3>Gauss points<a class="headerlink" href="#gauss-points" title="Permalink to this heading"></a></h3>
<table class="docutils align-default" id="id2">
<caption><span class="caption-number">Table 1 </span><span class="caption-text">Quad integration. Only one direction is spelled out, the second direction is done in the same way.</span><a class="headerlink" href="#id2" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Order</p></th>
<th class="head"><p>Integration point</p></th>
<th class="head"><p><span class="math notranslate nohighlight">\(\xi\)</span></p></th>
<th class="head"><p><span class="math notranslate nohighlight">\(\eta\)</span></p></th>
<th class="head"><p>weight</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(1\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(1\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(0\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(0\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(2\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(2\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(1\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-0.577\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-0.577\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(1\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(2\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(2\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(+0.577\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-0.577\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(1\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(3\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(1\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-0.775\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-0.775\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(0.556\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(3\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(2\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(0\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-0.775\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(0.889\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(3\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(3\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(+0.775\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(-0.775\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(0.556\)</span></p></td>
</tr>
</tbody>
</table>
</section>
<section id="isoparametric-elements">
<h3>Isoparametric elements<a class="headerlink" href="#isoparametric-elements" title="Permalink to this heading"></a></h3>
<p>So far so good, but how do we solve the integral in <a class="reference internal" href="#equation-eq-fem-2d-weak-num-int">equation (121)</a> using local coordinates? We will have to do a coordinate transformation for the purpose of numerical integration that relates the element <span class="math notranslate nohighlight">\(\Omega_e\)</span> to the master element area <span class="math notranslate nohighlight">\(\hat{\Omega}\)</span> - or, equivalently, <span class="math notranslate nohighlight">\((x,y)\)</span> to <span class="math notranslate nohighlight">\((ξ,η)\)</span>. This can be done by using interpolation functions in terms of local coordinates. We will use so-called <em>isoparametric</em> elements in which we use the same number of interpolation functions for coordinate mapping and primary variable interpolation. This implies for our four node element that the local variables vary bi-linearly over the element.</p>
<div class="math notranslate nohighlight" id="equation-eq-num-int-isoparam">
<span class="eqno">(123)<a class="headerlink" href="#equation-eq-num-int-isoparam" title="Permalink to this equation"></a></span>\[\begin{split}\begin{align}
\begin{split}
x=&amp;\sum_{j=1}^n \Phi_j(\xi,\eta)x_j \\
y=&amp;\sum_{j=1}^n \Phi_j(\xi,\eta)y_j, \\
\end{split}
\end{align}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(x_j\)</span> are the nodal coordinates. Our primary variable (temperature) interpolation functions are still in global coordinates:</p>
<div class="math notranslate nohighlight" id="equation-eq-num-int-isoparam-pv">
<span class="eqno">(124)<a class="headerlink" href="#equation-eq-num-int-isoparam-pv" title="Permalink to this equation"></a></span>\[T(x,y) = \sum_{j=1}^N N_j(x,y)T_j\]</div>
<p>We can express the shape functions N in terms of local coordinates using <a class="reference internal" href="#equation-eq-num-int-isoparam">equation (123)</a> and the chain rule of differentiation:</p>
<div class="math notranslate nohighlight" id="equation-eq-num-int-isoparam-2">
<span class="eqno">(125)<a class="headerlink" href="#equation-eq-num-int-isoparam-2" title="Permalink to this equation"></a></span>\[\begin{split}\begin{align}
\begin{split}
\frac{\partial N}{\partial \xi} =&amp; \frac{\partial N}{\partial x} \frac{\partial x}{\partial \xi} + \frac{\partial N}{\partial y} \frac{\partial y}{\partial \xi} \\
\frac{\partial N}{\partial \eta} =&amp; \frac{\partial N}{\partial x} \frac{\partial x}{\partial \eta} + \frac{\partial N}{\partial y} \frac{\partial y}{\partial \eta} \\
\end{split}
\end{align}\end{split}\]</div>
<p>Or in matrix form:</p>
<div class="math notranslate nohighlight" id="equation-eq-num-int-isoparam-3">
<span class="eqno">(126)<a class="headerlink" href="#equation-eq-num-int-isoparam-3" title="Permalink to this equation"></a></span>\[\begin{split}\begin{bmatrix}
\frac{\partial N}{\partial \xi} \\
\frac{\partial N}{\partial \eta}
\end{bmatrix} =
\begin{bmatrix}
\frac{\partial x}{\partial \xi} &amp;  \frac{\partial y}{\partial \xi} \\
\frac{\partial x}{\partial \eta} &amp; \frac{\partial y}{\partial \eta}
\end{bmatrix}
\begin{bmatrix}
\frac{\partial N}{\partial x} \\
\frac{\partial N}{\partial y},
\end{bmatrix}\end{split}\]</div>
</section>
<section id="jacobian-matrix">
<h3>Jacobian matrix<a class="headerlink" href="#jacobian-matrix" title="Permalink to this heading"></a></h3>
<p><a class="reference internal" href="#equation-eq-num-int-isoparam-3">equation (126)</a> gives the relationship between the derivatives of <span class="math notranslate nohighlight">\(N\)</span> with respect to the global and local coordinates. The matrix in <a class="reference internal" href="#equation-eq-num-int-isoparam-3">equation (126)</a> is called the Jacobian matrix, J, of the coordinate transformation. Unfortunately this relationship is in the wrong direction. If we have a look at our starting equation <a class="reference internal" href="#equation-eq-fem-2d-weak-num-int">equation (121)</a>, we realize that we need to relate the derivative with respect to global coordinates to the derivative with respect to local coordinates (which is the opposite direction). Fortunately this can be done quite easily:</p>
<div class="math notranslate nohighlight" id="equation-eq-num-int-isoparam-4">
<span class="eqno">(127)<a class="headerlink" href="#equation-eq-num-int-isoparam-4" title="Permalink to this equation"></a></span>\[\begin{split}\begin{bmatrix}
\frac{\partial N}{\partial x} \\
\frac{\partial N}{\partial y}
\end{bmatrix} =
\begin{bmatrix}
J^{-1}
\end{bmatrix}
\begin{bmatrix}
\frac{\partial N}{\partial \xi} \\
\frac{\partial N}{\partial \eta},
\end{bmatrix}\end{split}\]</div>
<p>Using <a class="reference internal" href="#equation-eq-num-int-isoparam">equation (123)</a> we can spell out the different components oft the Jacobian matrix:</p>
<div class="math notranslate nohighlight" id="equation-eq-num-int-jacobian">
<span class="eqno">(128)<a class="headerlink" href="#equation-eq-num-int-jacobian" title="Permalink to this equation"></a></span>\[\begin{split}\begin{bmatrix}
J
\end{bmatrix} =
\begin{bmatrix}
\frac{\partial x}{\partial \xi} &amp;  \frac{\partial y}{\partial \xi} \\
\frac{\partial x}{\partial \eta} &amp; \frac{\partial y}{\partial \eta}
\end{bmatrix} =
\begin{bmatrix}
\sum_{j=1}^n x_j \frac{\partial \Phi_j}{\partial \xi} &amp; \sum_{j=1}^n y_j \frac{\partial \Phi_j}{\partial \xi}\\
\sum_{j=1}^n x_j \frac{\partial \Phi_j}{\partial \eta} &amp; \sum_{j=1}^n y_j \frac{\partial \Phi_j}{\partial \eta},\\
\end{bmatrix}\end{split}\]</div>
<p>Finally the element area dA=dxdy of the original element in global coordinates is transformed to:</p>
<div class="math notranslate nohighlight" id="equation-eq-num-int-jacobian-1">
<span class="eqno">(129)<a class="headerlink" href="#equation-eq-num-int-jacobian-1" title="Permalink to this equation"></a></span>\[d\Omega_e = dxdy = det(J)d\xi d\eta\]</div>
<p>We have now all the information we need to solve the integral in <a class="reference internal" href="#equation-eq-fem-2d-weak-num-int">equation (121)</a> numerically:</p>
<div class="math notranslate nohighlight" id="equation-eq-num-int-jacobian-2">
<span class="eqno">(130)<a class="headerlink" href="#equation-eq-num-int-jacobian-2" title="Permalink to this equation"></a></span>\[\begin{split}\int_{\Omega_{e}} \left ( \frac{\partial N_i}{\partial x}k\frac{\partial N_j}{\partial x} + \frac{\partial N_i}{\partial y}k\frac{\partial N_j}{\partial y}  \right ) d\Omega_{e} T_j \approx \\ \left [ \sum_{ip} \left ( \frac{N_i(\xi_{ip},\eta_{ip})}{\partial x} k \frac{N_j(\xi_{ip},\eta_{ip})}{\partial x} + \frac{N_i(\xi_{ip},\eta_{ip})}{\partial y} k \frac{N_j(\xi_{ip},\eta_{ip})}{\partial y}
\right ) W_{ip} det(J) \right ] T_j\end{split}\]</div>
<p>It should be noted that the transformation of a quadrilateral element of a mesh to a master element <span class="math notranslate nohighlight">\(\hat{\Omega}\)</span> is solely for the purpose of numerically evaluating the integrals in <a class="reference internal" href="#equation-eq-fem-2d-weak-num-int">equation (121)</a> . No transformation of the physical domain or elements is involved in the finite element analysis.</p>
</section>
</section>
<section id="excercises">
<h2>Excercises<a class="headerlink" href="#excercises" title="Permalink to this heading"></a></h2>
<section id="fem-mesh">
<h3>FEM mesh<a class="headerlink" href="#fem-mesh" title="Permalink to this heading"></a></h3>
<p>The first excercise is about building the FEM mesh and element connectivity matrix that contains the information on which nodes belong to which element. Have a look at <a class="reference internal" href="#fig-mesh-2d-structured"><span class="std std-numref">Fig. 10</span></a> and follow the logic of that Figure.</p>
<ol class="arabic simple">
<li><p>Create the global coordinate vector GCOORD. Assume that the length of the box in x direction (lx) is 1 ([0,1]) and the length of box is y direction (ly) is also 1 ([0, 1]). The number of nodes in x is 5 (nx) and the number of nodes in y is 4 (ny).</p></li>
<li><p>Create the connectivity matrix ELEM2NODE. The element numbering should look like this:</p></li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<ul class="simple">
<li><p>Hint loop over all nodes and create their respective x and y coordinates. The node numbering should be like in <a class="reference internal" href="#fig-mesh-2d-structured"><span class="std std-numref">Fig. 10</span></a> (see jupyter notebook for a discussion).</p></li>
<li><p>Functions like ceil or floor might help you with the connectivity matrix; it might also help to first compute the row we are in and then compute the index of the lower left node and move on from there.</p></li>
</ul>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>We use a function called tabulate to format the output in the notebooks. You will probably have to install it into your virtual python environment.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda activate py37_fem_class
conda install tabulate
</pre></div>
</div>
</div>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="jupyter/2d_fem_connectivity.html">2-D FEM coordinate and connectivity matrices</a></li>
</ul>
</div>
</section>
<section id="shape-functions">
<h3>Shape functions<a class="headerlink" href="#shape-functions" title="Permalink to this heading"></a></h3>
<p>The second excercise is about spelling out the shape functions and their derivatives. Remember that the shape functions are defined in local coordinates. For bi-linear quads, they have this functional form:</p>
<div class="math notranslate nohighlight" id="equation-eq-shape-functions">
<span class="eqno">(131)<a class="headerlink" href="#equation-eq-shape-functions" title="Permalink to this equation"></a></span>\[\begin{split}\begin{align}
\begin{split}
\tilde{T}(x,y) = \sum_{j=1}^{n} N_jT_J = N_jT_J = NT \\
NT &amp;= \begin{bmatrix} N_1 &amp; N_2 &amp; N_3 &amp; N_4 \end{bmatrix} \begin{bmatrix} T_1 \\ T_2 \\ T_3 \\ T_4 \end{bmatrix}\\
N_1 &amp; = 0.25(1-\xi)(1-\eta) \\
N_2 &amp; = 0.25(1+\xi)(1-\eta) \\
N_3 &amp; = 0.25(1+\xi)(1+\eta) \\
N_4 &amp; = 0.25(1-\xi)(1+\eta) \\
\end{split}
\end{align}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(T_{j=1..4}\)</span> are the four nodal temperatures, <span class="math notranslate nohighlight">\(\tilde{T}\)</span> is the temperature at an (integration) point inside the element, <span class="math notranslate nohighlight">\(N\)</span> are the four shape functions, and <span class="math notranslate nohighlight">\((\xi,\eta)\)</span> are the two local coordinates between -1 and 1.</p>
<p>Implement the shape functions in a jupyter notebook, also compute the eight derivatives with local coordinates <span class="math notranslate nohighlight">\((\xi,\eta)\)</span>, and try them out on a single element with coordinates -1,-1 to 1,1.</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="jupyter/FEM_2d_shapes_excercise.html">2-D FEM shape functions</a></li>
</ul>
</div>
</section>
</section>
</section>
<section id="implementation">
<h1>Implementation<a class="headerlink" href="#implementation" title="Permalink to this heading"></a></h1>
<p>Now we have assembled all the pieces that we need to make a finite element model and solve it. <a class="reference internal" href="#lst-2d-fem-ss"><span class="std std-numref">Listing 1</span></a> shows the complete python code for our first solver.</p>
<section id="python-code">
<h2>Python code<a class="headerlink" href="#python-code" title="Permalink to this heading"></a></h2>
<div class="literal-block-wrapper docutils container" id="lst-2d-fem-ss">
<div class="code-block-caption"><span class="caption-number">Listing 1 </span><span class="caption-text">2-D FEM diffusion, steady-state.</span><a class="headerlink" href="#lst-2d-fem-ss" title="Permalink to this code"></a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="linenos">  2</span><span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>
<span class="linenos">  3</span><span class="kn">from</span> <span class="nn">scipy.sparse.linalg</span> <span class="kn">import</span> <span class="n">spsolve</span>
<span class="linenos">  4</span><span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="kn">import</span> <span class="n">csr_matrix</span>
<span class="linenos">  5</span><span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="linenos">  6</span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="linenos">  7</span><span class="kn">from</span> <span class="nn">shapes</span> <span class="kn">import</span> <span class="n">shapes</span>
<span class="linenos">  8</span>
<span class="linenos">  9</span><span class="c1">#geometry</span>
<span class="linenos"> 10</span><span class="n">lx</span>          <span class="o">=</span> <span class="mi">1</span>
<span class="linenos"> 11</span><span class="n">ly</span>          <span class="o">=</span> <span class="mi">1</span>
<span class="linenos"> 12</span><span class="n">nx</span>          <span class="o">=</span> <span class="mi">51</span>
<span class="linenos"> 13</span><span class="n">ny</span>          <span class="o">=</span> <span class="mi">51</span>
<span class="linenos"> 14</span><span class="n">nnodel</span>      <span class="o">=</span> <span class="mi">4</span>
<span class="linenos"> 15</span><span class="n">dx</span>          <span class="o">=</span> <span class="n">lx</span><span class="o">/</span><span class="p">(</span><span class="n">nx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos"> 16</span><span class="n">dy</span>          <span class="o">=</span> <span class="n">ly</span><span class="o">/</span><span class="p">(</span><span class="n">ny</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos"> 17</span><span class="n">w_i</span>         <span class="o">=</span> <span class="mf">0.2</span> <span class="c1"># width inclusion</span>
<span class="linenos"> 18</span><span class="n">h_i</span>         <span class="o">=</span> <span class="mf">0.2</span> <span class="c1"># heigths inclusion</span>
<span class="linenos"> 19</span>
<span class="linenos"> 20</span><span class="c1"># model parameters</span>
<span class="linenos"> 21</span><span class="n">k1</span>          <span class="o">=</span> <span class="mi">1</span>
<span class="linenos"> 22</span><span class="n">k2</span>          <span class="o">=</span> <span class="mf">0.01</span>
<span class="linenos"> 23</span><span class="n">Ttop</span>        <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 24</span><span class="n">Tbot</span>        <span class="o">=</span> <span class="mi">1</span>
<span class="linenos"> 25</span>
<span class="linenos"> 26</span><span class="n">nex</span>         <span class="o">=</span> <span class="n">nx</span><span class="o">-</span><span class="mi">1</span>
<span class="linenos"> 27</span><span class="n">ney</span>         <span class="o">=</span> <span class="n">ny</span><span class="o">-</span><span class="mi">1</span>
<span class="linenos"> 28</span><span class="n">nnod</span>        <span class="o">=</span> <span class="n">nx</span><span class="o">*</span><span class="n">ny</span>
<span class="linenos"> 29</span><span class="n">nel</span>         <span class="o">=</span> <span class="n">nex</span><span class="o">*</span><span class="n">ney</span>
<span class="linenos"> 30</span><span class="n">GCOORD</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nnod</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="linenos"> 31</span><span class="n">T</span>           <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nnod</span><span class="p">)</span> <span class="c1">#initial T, not strictly needed</span>
<span class="linenos"> 32</span>
<span class="linenos"> 33</span><span class="c1"># global coordinates</span>
<span class="linenos"> 34</span><span class="nb">id</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 35</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ny</span><span class="p">):</span>
<span class="linenos"> 36</span>    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nx</span><span class="p">):</span>
<span class="linenos"> 37</span>        <span class="n">GCOORD</span><span class="p">[</span><span class="nb">id</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">lx</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">j</span><span class="o">*</span><span class="n">dx</span>
<span class="linenos"> 38</span>        <span class="n">GCOORD</span><span class="p">[</span><span class="nb">id</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">ly</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="n">dy</span>
<span class="linenos"> 39</span>        <span class="nb">id</span>          <span class="o">=</span> <span class="nb">id</span> <span class="o">+</span> <span class="mi">1</span>
<span class="linenos"> 40</span>
<span class="linenos"> 41</span><span class="c1"># FEM connectivity</span>
<span class="linenos"> 42</span><span class="n">EL2NOD</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nel</span><span class="p">,</span><span class="n">nnodel</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="linenos"> 43</span>
<span class="linenos"> 44</span><span class="k">for</span> <span class="n">iel</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nel</span><span class="p">):</span>
<span class="linenos"> 45</span>    <span class="n">row</span>        <span class="o">=</span> <span class="n">iel</span><span class="o">//</span><span class="n">nex</span>
<span class="linenos"> 46</span>    <span class="n">ind</span>        <span class="o">=</span> <span class="n">iel</span> <span class="o">+</span> <span class="n">row</span>
<span class="linenos"> 47</span>    <span class="n">EL2NOD</span><span class="p">[</span><span class="n">iel</span><span class="p">,:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="n">ind</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">ind</span><span class="o">+</span><span class="n">nx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">ind</span><span class="o">+</span><span class="n">nx</span><span class="p">]</span>
<span class="linenos"> 48</span>
<span class="linenos"> 49</span><span class="c1"># Gauss integration points</span>
<span class="linenos"> 50</span><span class="n">nip</span>   <span class="o">=</span> <span class="mi">4</span>
<span class="linenos"> 51</span><span class="n">gauss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)],</span> <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)]])</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="linenos"> 52</span>
<span class="linenos"> 53</span><span class="c1"># Storage</span>
<span class="linenos"> 54</span><span class="n">Rhs_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nnod</span><span class="p">)</span>
<span class="linenos"> 55</span><span class="n">I</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nel</span><span class="p">,</span><span class="n">nnodel</span><span class="o">*</span><span class="n">nnodel</span><span class="p">))</span>
<span class="linenos"> 56</span><span class="n">J</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nel</span><span class="p">,</span><span class="n">nnodel</span><span class="o">*</span><span class="n">nnodel</span><span class="p">))</span>
<span class="linenos"> 57</span><span class="n">K</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nel</span><span class="p">,</span><span class="n">nnodel</span><span class="o">*</span><span class="n">nnodel</span><span class="p">))</span>
<span class="linenos"> 58</span>
<span class="linenos"> 59</span><span class="k">for</span> <span class="n">iel</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nel</span><span class="p">):</span>
<span class="hll"><span class="linenos"> 60</span>    <span class="n">ECOORD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">GCOORD</span><span class="p">,</span> <span class="n">EL2NOD</span><span class="p">[</span><span class="n">iel</span><span class="p">,:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span> <span class="p">)</span>
</span><span class="linenos"> 61</span>    <span class="n">Ael</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nnodel</span><span class="p">,</span><span class="n">nnodel</span><span class="p">))</span>
<span class="linenos"> 62</span>    <span class="n">Rhs_el</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nnodel</span><span class="p">)</span>
<span class="linenos"> 63</span>
<span class="linenos"> 64</span>    <span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nip</span><span class="p">):</span>
<span class="hll"><span class="linenos"> 65</span>        <span class="c1"># 1. update shape functions</span>
</span><span class="hll"><span class="linenos"> 66</span>        <span class="n">xi</span>      <span class="o">=</span> <span class="n">gauss</span><span class="p">[</span><span class="n">ip</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span class="hll"><span class="linenos"> 67</span>        <span class="n">eta</span>     <span class="o">=</span> <span class="n">gauss</span><span class="p">[</span><span class="n">ip</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</span><span class="hll"><span class="linenos"> 68</span>        <span class="n">N</span><span class="p">,</span> <span class="n">dNds</span> <span class="o">=</span> <span class="n">shapes</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">eta</span><span class="p">)</span>
</span><span class="hll"><span class="linenos"> 69</span>
</span><span class="hll"><span class="linenos"> 70</span>        <span class="c1"># 2. set up Jacobian, inverse of Jacobian, and determinant</span>
</span><span class="hll"><span class="linenos"> 71</span>        <span class="n">Jac</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">dNds</span><span class="p">,</span><span class="n">ECOORD</span><span class="p">)</span> <span class="c1">#[2,nnodel]*[nnodel,2]</span>
</span><span class="hll"><span class="linenos"> 72</span>        <span class="n">invJ</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Jac</span><span class="p">)</span>
</span><span class="hll"><span class="linenos"> 73</span>        <span class="n">detJ</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">Jac</span><span class="p">)</span>
</span><span class="hll"><span class="linenos"> 74</span>
</span><span class="hll"><span class="linenos"> 75</span>        <span class="c1"># 3. get global derivatives</span>
</span><span class="hll"><span class="linenos"> 76</span>        <span class="n">dNdx</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">invJ</span><span class="p">,</span> <span class="n">dNds</span><span class="p">)</span> <span class="c1"># [2,2]*[2,nnodel]</span>
</span><span class="hll"><span class="linenos"> 77</span>
</span><span class="hll"><span class="linenos"> 78</span>        <span class="c1"># 4. compute element stiffness matrix</span>
</span><span class="hll"><span class="linenos"> 79</span>        <span class="n">kel</span> <span class="o">=</span> <span class="n">k1</span>
</span><span class="hll"><span class="linenos"> 80</span>        <span class="k">if</span>  <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ECOORD</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]))</span><span class="o">&lt;</span><span class="n">w_i</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ECOORD</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]))</span><span class="o">&lt;</span><span class="n">h_i</span><span class="p">:</span>
</span><span class="hll"><span class="linenos"> 81</span>            <span class="n">kel</span><span class="o">=</span><span class="n">k2</span>
</span><span class="hll"><span class="linenos"> 82</span>        <span class="n">Ael</span>     <span class="o">=</span> <span class="n">Ael</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">dNdx</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">dNdx</span><span class="p">)</span><span class="o">*</span><span class="n">detJ</span><span class="o">*</span><span class="n">kel</span> <span class="c1"># [nnodel,1]*[1,nnodel] / weights are missing, they are 1</span>
</span><span class="hll"><span class="linenos"> 83</span>
</span><span class="hll"><span class="linenos"> 84</span>        <span class="c1"># 5. assemble right-hand side, no source terms, just here for completeness</span>
</span><span class="hll"><span class="linenos"> 85</span>        <span class="n">Rhs_el</span>     <span class="o">=</span> <span class="n">Rhs_el</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nnodel</span><span class="p">)</span>
</span><span class="linenos"> 86</span>
<span class="linenos"> 87</span>    <span class="c1"># assemble coefficients</span>
<span class="linenos"> 88</span>    <span class="n">I</span><span class="p">[</span><span class="n">iel</span><span class="p">,:]</span>  <span class="o">=</span>  <span class="p">(</span><span class="n">EL2NOD</span><span class="p">[</span><span class="n">iel</span><span class="p">,:]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nnodel</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nnodel</span><span class="o">*</span><span class="n">nnodel</span><span class="p">)</span>
<span class="linenos"> 89</span>    <span class="n">J</span><span class="p">[</span><span class="n">iel</span><span class="p">,:]</span>  <span class="o">=</span>  <span class="p">(</span><span class="n">EL2NOD</span><span class="p">[</span><span class="n">iel</span><span class="p">,:]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nnodel</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nnodel</span><span class="o">*</span><span class="n">nnodel</span><span class="p">)</span>
<span class="linenos"> 90</span>    <span class="n">K</span><span class="p">[</span><span class="n">iel</span><span class="p">,:]</span>  <span class="o">=</span>  <span class="n">Ael</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nnodel</span><span class="o">*</span><span class="n">nnodel</span><span class="p">)</span>
<span class="linenos"> 91</span>
<span class="linenos"> 92</span>    <span class="n">Rhs_all</span><span class="p">[</span><span class="n">EL2NOD</span><span class="p">[</span><span class="n">iel</span><span class="p">,:]]</span> <span class="o">+=</span> <span class="n">Rhs_el</span>
<span class="linenos"> 93</span>
<span class="linenos"> 94</span><span class="n">A_all</span> <span class="o">=</span> <span class="n">csr_matrix</span><span class="p">((</span><span class="n">K</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nel</span><span class="o">*</span><span class="n">nnodel</span><span class="o">*</span><span class="n">nnodel</span><span class="p">),(</span><span class="n">I</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nel</span><span class="o">*</span><span class="n">nnodel</span><span class="o">*</span><span class="n">nnodel</span><span class="p">),</span><span class="n">J</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nel</span><span class="o">*</span><span class="n">nnodel</span><span class="o">*</span><span class="n">nnodel</span><span class="p">))),</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">nnod</span><span class="p">,</span><span class="n">nnod</span><span class="p">))</span>
<span class="linenos"> 95</span>
<span class="linenos"> 96</span><span class="c1"># indices and values at top and bottom</span>
<span class="linenos"> 97</span><span class="n">i_bot</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nx</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="linenos"> 98</span><span class="n">i_top</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nx</span><span class="o">*</span><span class="p">(</span><span class="n">ny</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">nx</span><span class="o">*</span><span class="n">ny</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="linenos"> 99</span><span class="n">Ind_bc</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">i_bot</span><span class="p">,</span> <span class="n">i_top</span><span class="p">))</span>
<span class="linenos">100</span><span class="n">Val_bc</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">i_bot</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">*</span><span class="n">Tbot</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">i_top</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">*</span><span class="n">Ttop</span> <span class="p">))</span>
<span class="linenos">101</span>
<span class="linenos">102</span><span class="c1"># smart way of boundary conditions that keeps matrix symmetry</span>
<span class="hll"><span class="linenos">103</span><span class="n">Free</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nnod</span><span class="p">)</span>
</span><span class="hll"><span class="linenos">104</span><span class="n">Free</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">Free</span><span class="p">,</span> <span class="n">Ind_bc</span><span class="p">)</span>
</span><span class="hll"><span class="linenos">105</span><span class="n">TMP</span>     <span class="o">=</span> <span class="n">A_all</span><span class="p">[:,</span><span class="n">Ind_bc</span><span class="p">]</span>
</span><span class="hll"><span class="linenos">106</span><span class="n">Rhs_all</span> <span class="o">=</span> <span class="n">Rhs_all</span> <span class="o">-</span> <span class="n">TMP</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Val_bc</span><span class="p">)</span>
</span><span class="hll"><span class="linenos">107</span>
</span><span class="hll"><span class="linenos">108</span><span class="c1"># solve reduced system</span>
</span><span class="hll"><span class="linenos">109</span><span class="n">T</span><span class="p">[</span><span class="n">Free</span><span class="p">]</span> <span class="o">=</span> <span class="n">spsolve</span><span class="p">(</span><span class="n">A_all</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">Free</span><span class="p">,</span> <span class="n">Free</span><span class="p">)],</span><span class="n">Rhs_all</span><span class="p">[</span><span class="n">Free</span><span class="p">])</span>
</span><span class="hll"><span class="linenos">110</span><span class="n">T</span><span class="p">[</span><span class="n">Ind_bc</span><span class="p">]</span> <span class="o">=</span> <span class="n">Val_bc</span>
</span><span class="linenos">111</span>
<span class="linenos">112</span><span class="c1"># postprocessing - heat flow</span>
<span class="linenos">113</span><span class="n">Q_x</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nel</span><span class="p">)</span>
<span class="linenos">114</span><span class="n">Q_y</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nel</span><span class="p">)</span>
<span class="linenos">115</span><span class="n">Ec_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nel</span><span class="p">)</span>
<span class="linenos">116</span><span class="n">Ec_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nel</span><span class="p">)</span>
<span class="linenos">117</span>
<span class="linenos">118</span><span class="k">for</span> <span class="n">iel</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nel</span><span class="p">):</span>
<span class="linenos">119</span>    <span class="c1"># 0. get element coordinates</span>
<span class="linenos">120</span>    <span class="n">ECOORD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">GCOORD</span><span class="p">,</span> <span class="n">EL2NOD</span><span class="p">[</span><span class="n">iel</span><span class="p">,:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span> <span class="p">)</span>
<span class="linenos">121</span>
<span class="linenos">122</span>    <span class="c1"># 1. update shape functions</span>
<span class="linenos">123</span>    <span class="n">xi</span>      <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">124</span>    <span class="n">eta</span>     <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">125</span>    <span class="n">N</span><span class="p">,</span> <span class="n">dNds</span> <span class="o">=</span> <span class="n">shapes</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">eta</span><span class="p">)</span>
<span class="linenos">126</span>
<span class="linenos">127</span>    <span class="c1"># 2. set up Jacobian, inverse of Jacobian, and determinant</span>
<span class="linenos">128</span>    <span class="n">Jac</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">dNds</span><span class="p">,</span><span class="n">ECOORD</span><span class="p">)</span> <span class="c1">#[2,nnodel]*[nnodel,2]</span>
<span class="linenos">129</span>    <span class="n">invJ</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Jac</span><span class="p">)</span>
<span class="linenos">130</span>    <span class="n">detJ</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">Jac</span><span class="p">)</span>
<span class="linenos">131</span>
<span class="linenos">132</span>    <span class="c1"># 3. get global derivatives</span>
<span class="linenos">133</span>    <span class="n">dNdx</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">invJ</span><span class="p">,</span> <span class="n">dNds</span><span class="p">)</span> <span class="c1"># [2,2]*[2,nnodel]</span>
<span class="linenos">134</span>
<span class="linenos">135</span>    <span class="c1"># 4. heat flux per element</span>
<span class="linenos">136</span>    <span class="n">kel</span> <span class="o">=</span> <span class="n">k1</span>
<span class="linenos">137</span>    <span class="k">if</span>  <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ECOORD</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]))</span><span class="o">&lt;</span><span class="mf">0.25</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ECOORD</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]))</span><span class="o">&lt;</span><span class="mf">0.25</span><span class="p">:</span>
<span class="linenos">138</span>        <span class="n">kel</span><span class="o">=</span><span class="n">k2</span>
<span class="linenos">139</span>    <span class="n">Q_x</span><span class="p">[</span><span class="n">iel</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">kel</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">dNdx</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">EL2NOD</span><span class="p">[</span><span class="n">iel</span><span class="p">,:]))</span>
<span class="linenos">140</span>    <span class="n">Q_y</span><span class="p">[</span><span class="n">iel</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">kel</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">dNdx</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">EL2NOD</span><span class="p">[</span><span class="n">iel</span><span class="p">,:]))</span>
<span class="linenos">141</span>    <span class="n">Ec_x</span><span class="p">[</span><span class="n">iel</span><span class="p">]</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ECOORD</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
<span class="linenos">142</span>    <span class="n">Ec_y</span><span class="p">[</span><span class="n">iel</span><span class="p">]</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ECOORD</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
<span class="linenos">143</span>
<span class="linenos">144</span><span class="c1"># plotting</span>
<span class="linenos">145</span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="linenos">146</span><span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span>
<span class="linenos">147</span><span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">])</span>
<span class="linenos">148</span>
<span class="linenos">149</span><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">GCOORD</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">ny</span><span class="p">,</span><span class="n">nx</span><span class="p">))</span>
<span class="linenos">150</span><span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">GCOORD</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">ny</span><span class="p">,</span><span class="n">nx</span><span class="p">))</span>
<span class="linenos">151</span><span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">ny</span><span class="p">,</span><span class="n">nx</span><span class="p">))</span>
<span class="linenos">152</span>
<span class="linenos">153</span><span class="n">cp</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
<span class="linenos">154</span><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cp</span><span class="p">)</span>
<span class="linenos">155</span><span class="n">plt</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">Ec_x</span><span class="p">,</span> <span class="n">Ec_y</span><span class="p">,</span> <span class="n">Q_x</span><span class="p">,</span> <span class="n">Q_y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">Q_x</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">Q_y</span><span class="p">)),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;autumn&#39;</span><span class="p">)</span>
<span class="linenos">156</span>
<span class="linenos">157</span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Temperature with heat flow vectors&#39;</span><span class="p">)</span>
<span class="linenos">158</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="linenos">159</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="linenos">160</span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
<p>The key components of the code are an element loop (which corresponds to the sum over the integrals in <a class="reference internal" href="#equation-eq-fem-2d-weak-3">equation (120)</a> and an integration loop (which corresponds to the loop over integration points in <a class="reference internal" href="#equation-eq-fem-2d-weak-3">equation (120)</a>). Most of the work is done inside the integration loop:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>shape functions are calculated at the local coordinates of the integration point</p></li>
<li><p>The Jacobian matrix, its determinant, and the inverse Jacobian are is calculated according to <a class="reference internal" href="#equation-eq-num-int-isoparam-4">equation (127)</a></p></li>
<li><p>Global derivatives of shape functions at local coordinates are calculated according to <a class="reference internal" href="#equation-eq-num-int-jacobian">equation (128)</a></p></li>
<li><p>The element stiffness matrix and the element force vector are integrated.</p></li>
</ol>
<p>After the integration</p>
<ol class="arabic simple">
<li><p>the local stiffness matrices and their global coefficients are stored</p></li>
<li><p>and the element force vector is added to the global force vector</p></li>
</ol>
</div></blockquote>
<p>Let’s have a closer look at some of the different steps.</p>
</section>
<section id="jacobian">
<h2>Jacobian:<a class="headerlink" href="#jacobian" title="Permalink to this heading"></a></h2>
<p>The calculation of the Jacobian matrix is implemented via  <a class="reference internal" href="#equation-eq-num-int-isoparam-4">equation (127)</a>  as a matrix-vector multiplication:</p>
<div class="math notranslate nohighlight" id="equation-eq-jacobian-code">
<span class="eqno">(132)<a class="headerlink" href="#equation-eq-jacobian-code" title="Permalink to this equation"></a></span>\[\begin{split}J =
\begin{bmatrix}
\frac{\partial N_1}{\partial \xi} &amp; \frac{\partial N_2}{\partial \xi} &amp; \frac{\partial N_3}{\partial \xi} &amp; \frac{\partial N_4}{\partial \xi} \\
\frac{\partial N_1}{\partial \eta} &amp; \frac{\partial N_2}{\partial \eta} &amp; \frac{\partial N_3}{\partial \eta} &amp; \frac{\partial N_4}{\partial \eta}
\end{bmatrix}
=
\begin{bmatrix}
x_1 &amp; y_1 \\
x_2 &amp; y_2 \\
x_3 &amp; y_3 \\
x_4 &amp; y_4 \\
\end{bmatrix}
=
\begin{bmatrix}
\frac{\partial x}{\partial \xi} &amp; \frac{\partial y}{\partial \xi} \\
\frac{\partial x}{\partial \eta} &amp; \frac{\partial y}{\partial \eta}
\end{bmatrix},\end{split}\]</div>
<p>which is implemented as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ECOORD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">GCOORD</span><span class="p">,</span> <span class="n">EL2NOD</span><span class="p">[</span><span class="n">iel</span><span class="p">,:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span> <span class="p">)</span>
<span class="n">Jac</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">dNds</span><span class="p">,</span><span class="n">ECOORD</span><span class="p">)</span> <span class="c1">#[2,nnodel]*[nnodel,2]</span>
</pre></div>
</div>
</section>
<section id="global-derivatives-of-shape-functions">
<h2>Global derivatives of shape functions<a class="headerlink" href="#global-derivatives-of-shape-functions" title="Permalink to this heading"></a></h2>
<p>The global derivatives are calculated according to <a class="reference internal" href="#equation-eq-num-int-jacobian">equation (128)</a>, which in matrix form is:</p>
<div class="math notranslate nohighlight" id="equation-eq-dndx-code">
<span class="eqno">(133)<a class="headerlink" href="#equation-eq-dndx-code" title="Permalink to this equation"></a></span>\[\begin{split}\begin{bmatrix}
\frac{\partial N_1}{\partial x} &amp; \frac{\partial N_2}{\partial x} &amp; \frac{\partial N_3}{\partial x} &amp; \frac{\partial N_4}{\partial x} \\
\frac{\partial N_1}{\partial y} &amp; \frac{\partial N_2}{\partial y} &amp; \frac{\partial N_3}{\partial y} &amp; \frac{\partial N_4}{\partial y}
\end{bmatrix}
=
\begin{bmatrix}
J^{-1}
\end{bmatrix}
\begin{bmatrix}
\frac{\partial N_1}{\partial \xi} &amp; \frac{\partial N_2}{\partial \xi} &amp; \frac{\partial N_3}{\partial \xi} &amp; \frac{\partial N_4}{\partial \xi} \\
\frac{\partial N_1}{\partial \eta} &amp; \frac{\partial N_2}{\partial \eta} &amp; \frac{\partial N_3}{\partial \eta} &amp; \frac{\partial N_4}{\partial \eta}
\end{bmatrix},\end{split}\]</div>
<p>which is implemented as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dNdx</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">invJ</span><span class="p">,</span> <span class="n">dNds</span><span class="p">)</span> <span class="c1"># [2,2]*[2,nnodel]</span>
</pre></div>
</div>
</section>
<section id="element-stiffness-matrix">
<h2>Element stiffness matrix<a class="headerlink" href="#element-stiffness-matrix" title="Permalink to this heading"></a></h2>
<p>The final step is to put the <a class="reference internal" href="#equation-eq-num-int-jacobian-2">equation (130)</a> into finite element form. Also this now quite easy:</p>
<div class="math notranslate nohighlight" id="equation-eq-ael-code">
<span class="eqno">(134)<a class="headerlink" href="#equation-eq-ael-code" title="Permalink to this equation"></a></span>\[\begin{split}\begin{bmatrix}
\begin{bmatrix}
\frac{\partial N_1}{\partial x} &amp; \frac{\partial N_1}{\partial y} \\
\frac{\partial N_2}{\partial x} &amp; \frac{\partial N_2}{\partial y} \\
\frac{\partial N_3}{\partial x} &amp; \frac{\partial N_3}{\partial y} \\
\frac{\partial N_4}{\partial x} &amp; \frac{\partial N_4}{\partial y}
\end{bmatrix}
\begin{bmatrix}
\frac{\partial N_1}{\partial x} &amp; \frac{\partial N_2}{\partial x} &amp; \frac{\partial N_3}{\partial x} &amp; \frac{\partial N_4}{\partial x} \\
\frac{\partial N_1}{\partial y} &amp; \frac{\partial N_2}{\partial y} &amp; \frac{\partial N_3}{\partial y} &amp; \frac{\partial N_4}{\partial y}
\end{bmatrix}
\end{bmatrix}
\begin{bmatrix}
T_1 \\ T_2 \\ T_3 \\ T_4
\end{bmatrix}
=
\begin{bmatrix}
0 \\ 0 \\ 0 \\ 0
\end{bmatrix},\end{split}\]</div>
<p>where the first matrix is the element stiffness matrix, which is implemented as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Ael</span>     <span class="o">=</span> <span class="n">Ael</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">dNdx</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">dNdx</span><span class="p">)</span><span class="o">*</span><span class="n">detJ</span><span class="o">*</span><span class="n">kel</span> <span class="c1"># [nnodel,1]*[1,nnodel] / weights are missing, they are 1</span>
</pre></div>
</div>
</section>
<section id="boundary-conditions">
<h2>Boundary conditions<a class="headerlink" href="#boundary-conditions" title="Permalink to this heading"></a></h2>
<p>Before we can solve anything, we need to set boundary conditions. In the 1-D case, we had set the boundary conditions in the usual way by setting the entire row to zero, putting a 1 on the main diagonal, and setting the Rhs to the specified temperature. We had noted before that this procedure breaks matrix symmetry. We will therefore use a more elaborate method here, which was described in <span id="id1">[<a class="reference internal" href="../refs.html#id35" title="M. Dabrowski, M. Krotkiewski, and D. W. Schmid. Milamin: matlab-based finite element method solver for large problems. Geochemistry Geophysics Geosystems, 2008. URL: &lt;Go to ISI&gt;://000255458100002 http://www.agu.org/journals/gc/gc0804/2007GC001719/2007GC001719.pdf, doi:10.1029/2007gc001719.">Dabrowski et al., 2008</a>]</span> .
We add the columns that refer to nodes with boundary conditions to the righ-hand side and afterwards solve the smaller system of equations! This is implemented as</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># indices and values at top and bottom</span>
<span class="n">i_bot</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nx</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">i_top</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nx</span><span class="o">*</span><span class="p">(</span><span class="n">ny</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">nx</span><span class="o">*</span><span class="n">ny</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">Ind_bc</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">i_bot</span><span class="p">,</span> <span class="n">i_top</span><span class="p">))</span>
<span class="n">Val_bc</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">i_bot</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">*</span><span class="n">Tbot</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">i_top</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">*</span><span class="n">Ttop</span> <span class="p">))</span>

<span class="c1"># smart way of boundary conditions that keeps matrix symmetry</span>
<span class="n">Free</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nnod</span><span class="p">)</span>
<span class="n">Free</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">Free</span><span class="p">,</span> <span class="n">Ind_bc</span><span class="p">)</span>
<span class="n">TMP</span>     <span class="o">=</span> <span class="n">A_all</span><span class="p">[:,</span><span class="n">Ind_bc</span><span class="p">]</span>
<span class="n">Rhs_all</span> <span class="o">=</span> <span class="n">Rhs_all</span> <span class="o">-</span> <span class="n">TMP</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Val_bc</span><span class="p">)</span>

<span class="c1"># solve reduced system</span>
<span class="n">T</span><span class="p">[</span><span class="n">Free</span><span class="p">]</span> <span class="o">=</span> <span class="n">spsolve</span><span class="p">(</span><span class="n">A_all</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">Free</span><span class="p">,</span> <span class="n">Free</span><span class="p">)],</span><span class="n">Rhs_all</span><span class="p">[</span><span class="n">Free</span><span class="p">])</span>
<span class="n">T</span><span class="p">[</span><span class="n">Ind_bc</span><span class="p">]</span> <span class="o">=</span> <span class="n">Val_bc</span>
</pre></div>
</div>
<p>First we find all the global indices of the nodes with boundary conditions and build a vector of equal length with all the fixed values. Afterwards we move the columns to the Rhs and solve the smaller system of equations.
Note how the Rhs is a vector full of zeros at the moment. This will change when we look at the transient problem!</p>
<div class="admonition-excercise admonition">
<p class="admonition-title">Excercise</p>
<p>You can download the python code here (<a class="reference download internal" download="" href="../_downloads/743ffc15244f281408a980240fbec025/2d_fem_steady_state.py"><code class="xref download docutils literal notranslate"><span class="pre">2d_fem_steady_state.py</span></code></a> and <a class="reference download internal" download="" href="../_downloads/106121a7df94058c4432deb1438e673f/shapes.py"><code class="xref download docutils literal notranslate"><span class="pre">shapes.py</span></code></a>). Try to get it to work and make sure that you understand the key parts. I good way is to use the Visual Studio Code debugger and to step through the code. Make sure that you understand the various matrix shapes and the connection between the equations presented above and the matrix multiplications in the code.</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="overview.html" class="btn btn-neutral float-left" title="Overview" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="jupyter/2d_fem_connectivity.html" class="btn btn-neutral float-right" title="2-D FEM coordinate and connectivity matrices" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Lars Ruepke and Zhikui Guo.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
      
        <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
          <span class="rst-current-version" data-toggle="rst-current-version">
            <span class="fa fa-book"> Finite Element Modeling in Geodynamics</span>
            v: latest
            <span class="fa fa-caret-down"></span>
          </span>
          <div class="rst-other-versions">
            <dl>
              
                
                <dd><a href="https://lruepke.github.io/FEM_lecture/downloads/LectureNote.pdf">latest</a></dd>
                
                <dd><a href="#/LectureNote.pdf">2.0</a></dd>
                
              
          </div>
        </div>
      
    

</body>
</html>