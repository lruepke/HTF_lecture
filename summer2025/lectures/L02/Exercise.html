


<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Excercise &mdash; HydrothermalFoam Lecture  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d8a2add5" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=4c969af8" />
      <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/style.css?v=379f3234" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/tabs.js?v=3ee01567"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Lecture overview" href="../L03/Overview.html" />
    <link rel="prev" title="Navier-Stokes flow with OpenFoam" href="Example.html" /> 
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-EJ32EEFYRN"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-EJ32EEFYRN');
    </script>   

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            HydrothermalFoam Lecture
              <img src="../../_static/DRP_vert_cover.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
    
              <p class="caption" role="heading"><span class="caption-text">Course information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../general-info/course-details.html">Course details</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Lecture 1</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../L01/Overview.html">Lecture overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../L01/Installation.html">Installation guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../L01/OpenFoam.html">Getting started with OpenFoam</a></li>
<li class="toctree-l1"><a class="reference internal" href="../L01/FirstCase.html">A first test case - heat diffusion</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Lecture 2</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Overview.html">Lecture overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="Example.html">Navier-Stokes flow with OpenFoam</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Excercise</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#d-cavity-flow">3-D cavity flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="#getting-fancy-let-s-make-a-parallel-run">Getting fancy - let’s make a parallel run</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Lecture 3</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../L03/Overview.html">Lecture overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../L03/intro.html">Digital Rock Physics - Effective Permeability of Rocks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../L03/FirstCase.html">Flow on the pore scale</a></li>
<li class="toctree-l1"><a class="reference internal" href="../L03/Exercise.html">Exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="../L03/Theory.html">Theoretical background</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Lecture 4</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../L04/Overview.html">Lecture overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../L04/intro.html">Porous Flow - Submarine Hydrothermal Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../L04/FirstCase.html">Hydrothermal convection test case</a></li>
<li class="toctree-l1"><a class="reference internal" href="../L04/Exercise.html">Excercises</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Lecture 5</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../L05/Overview.html">Lecture overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../L05/intro.html">Upflow temperatures in submarine hydrothermal systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../L05/Exercise1.html">Exercise 1: Fluid properties</a></li>
<li class="toctree-l1"><a class="reference internal" href="../L05/Exercise2.html">Exercise 2: Fluxibility and Tvent</a></li>
<li class="toctree-l1"><a class="reference internal" href="../L05/Exercise3.html">Exercise 3: Permeability and Tvent</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Lecture 6</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../L06/Overview.html">Lecture overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../L06/intro.html">Structural controls on hydrothermal flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../L06/Exercise1.html">Exercise 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../L06/Exercise2.html">Exercise 2</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Lecture 7</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../L_FVM/Overview.html">Lecture overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../L_FVM/intro.html">FVM and OpenFoam</a></li>
<li class="toctree-l1"><a class="reference internal" href="../L_FVM/Implementation1.html">OpenFoam implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../L_FVM/Advection1.html">The advection term</a></li>
<li class="toctree-l1"><a class="reference internal" href="../L_FVM/Excercise_adv.html">Excercise on advection schemes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Projects</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../L_PROJECTS/Project1.html">Project 1: Flow along a detachment fault</a></li>
<li class="toctree-l1"><a class="reference internal" href="../L_PROJECTS/Project2.html">Project 2: How long can a magmatic intrusion sustain high temperature venting?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../L_PROJECTS/Project3.html">Project 3: Hydrofracturing and localized venting above sill intrusion?</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../refs.html">References</a></li>
</ul>


    
        <p class="caption">
            <span class="caption-text">Getting help</span>
        </p>
        <ul>
            
                <li class="toctree-l1"><a href="https://lruepke.github.io/HTF_lecture/imprint/"><i class="fa fa-stamp"></i> Imprint</a></li>
            
                <li class="toctree-l1"><a href="mailto:lruepke@geomar.de"><i class="fa fa-envelope fa-fw"></i> Prof. Lars Ruepke</a></li>
            
                <li class="toctree-l1"><a href="mailto:zguo@geomar.de"><i class="fa fa-envelope fa-fw"></i> Dr. Zhikui Guo</a></li>
            
                <li class="toctree-l1"><a href="https://www.hydrothermalfoam.info"><i class="fa fa-gitlab fa-fw"></i> HydrothermalFoam</a></li>
            
                <li class="toctree-l1"><a href="https://www.openfoam.org"><i class="fa fa-github fa-fw"></i> OpenFOAM</a></li>
            
                <li class="toctree-l1"><a href="https://lruepke.github.io/HTF_lecture/"><i class="fa fa-home fa-fw"></i> Public site</a></li>
            
                <li class="toctree-l1"><a href="https://lms.uni-kiel.de/url/RepositoryEntry/3664576582"><i class="fa fa-home fa-fw"></i> University site</a></li>
            
        </ul>
    

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">HydrothermalFoam Lecture</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Excercise</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/lruepke/HTF_lecture/blob/main/Summer2022/source/lectures/L02/Exercise.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="excercise">
<span id="l02-exercise"></span><h1>Excercise<a class="headerlink" href="#excercise" title="Link to this heading"></a></h1>
<p>After we have mananged to solve for 2-D cavity flow, it’s time to try 3-D. And parralel proccessing!</p>
<section id="d-cavity-flow">
<h2>3-D cavity flow<a class="headerlink" href="#d-cavity-flow" title="Link to this heading"></a></h2>
<p>First, try to make a 3-D simulations. Start by copying the case to a new folder and to clean the case</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cp<span class="w"> </span>-r<span class="w"> </span>cavity2D<span class="w"> </span>cavity3D
./clean.sh
</pre></div>
</div>
<div class="admonition-now-these-things-have-to-happen admonition">
<p class="admonition-title">Now these things have to happen</p>
<ul class="simple">
<li><p>make the mesh 3-D by having cells in the z-direction</p></li>
<li><p>make sure the the front and back sides are not set to “empty” anymore</p></li>
<li><p>set proper boundary conditions for front and back</p></li>
<li><p>run it and hope for the best!</p></li>
</ul>
</div>
</section>
<section id="getting-fancy-let-s-make-a-parallel-run">
<h2>Getting fancy - let’s make a parallel run<a class="headerlink" href="#getting-fancy-let-s-make-a-parallel-run" title="Link to this heading"></a></h2>
<p>Three-dimensional simulations need a lot of computing resources and thankfully OpenFoam is fully parallelized and very efficient in making parallel runs. The standard parallelization technique in OpenFoam is called “domain decompositon”. This means that the compuational domain is split into sub-domains and each sub-domain is send to one of the computional cores. As always, all of this is controlled via a dictionary file. This file is called <code class="code docutils literal notranslate"><span class="pre">system/decomposeParDict</span></code> .</p>
<p>To get started we make a copy of our 3-D case.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cp<span class="w"> </span>-r<span class="w"> </span>cavity3D<span class="w"> </span>cavity3D_par
./clean.sh
</pre></div>
</div>
<p>Unfortunately, theree is no file <code class="code docutils literal notranslate"><span class="pre">system/decomposeParDict</span></code> in our example case… Fortunately, there is probably an example file somewhere in all the provided tutorials. A simple way to find and copy one is this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span>
find<span class="w">  </span>.<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;decomposeParDict&quot;</span>
./hydrothermalfoam-master/cookbooks/parallel_serial/fixedTfixedFluxPressure/2d_par/system/decomposeParDict
./hydrothermalfoam-master/cookbooks/parallel_serial/fixedTnoFlux/2d_par/system/decomposeParDict
./hydrothermalfoam-master/cookbooks/3Dbox_par/system/decomposeParDict
./hydrothermalfoam-master/cookbooks/helloworld_par/system/decomposeParDict
cp<span class="w"> </span>./hydrothermalfoam-master/cookbooks/helloworld_par/system/decomposeParDict<span class="w"> </span><span class="nv">$HOME</span>/HydrothermalFoam_runs/cavity3D_par
</pre></div>
</div>
<p>Now open this file and edit it; it should look like this</p>
<div class="literal-block-wrapper docutils container" id="lst-3dcavity-par">
<div class="code-block-caption"><span class="caption-number">Listing 9 </span><span class="caption-text">Domain decomposition and parallel processing.</span><a class="headerlink" href="#lst-3dcavity-par" title="Link to this code"></a></div>
<div class="highlight-foam notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cm">/*--------------------------------*- C++ -*----------------------------------*\</span>
<span class="linenos"> 2</span><span class="cm">=========                 |</span>
<span class="linenos"> 3</span><span class="cm">\\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox</span>
<span class="linenos"> 4</span><span class="cm"> \\    /   O peration     | Website:  https://openfoam.org</span>
<span class="linenos"> 5</span><span class="cm">  \\  /    A nd           | Version:  7</span>
<span class="linenos"> 6</span><span class="cm">   \\/     M anipulation  |</span>
<span class="linenos"> 7</span><span class="cm">\*---------------------------------------------------------------------------*/</span>
<span class="linenos"> 8</span><span class="k">FoamFile</span>
<span class="linenos"> 9</span><span class="p">{</span>
<span class="linenos">10</span>    <span class="kt">version</span>     <span class="mf">2.0</span><span class="p">;</span>
<span class="linenos">11</span>    <span class="kt">format</span>      <span class="k">ascii</span><span class="p">;</span>
<span class="linenos">12</span>    <span class="kt">class</span>       <span class="k">dictionary</span><span class="p">;</span>
<span class="linenos">13</span>    <span class="kt">location</span>    <span class="s">&quot;system&quot;</span><span class="p">;</span>
<span class="linenos">14</span>    <span class="kt">object</span>      <span class="n">decomposeParDict</span><span class="p">;</span>
<span class="linenos">15</span><span class="p">}</span>
<span class="linenos">16</span><span class="c1">// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //</span>
<span class="linenos">17</span>
<span class="hll"><span class="linenos">18</span><span class="k">numberOfSubdomains</span> <span class="mi">4</span><span class="p">;</span>
</span><span class="linenos">19</span>
<span class="linenos">20</span><span class="n">method</span>          <span class="n">scotch</span><span class="p">;</span>
<span class="linenos">21</span>
<span class="linenos">22</span><span class="k">simpleCoeffs</span>
<span class="linenos">23</span><span class="p">{</span>
<span class="hll"><span class="linenos">24</span>    <span class="k">n</span>               <span class="p">(</span><span class="mi">2</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">);</span>
</span><span class="linenos">25</span>    <span class="k">delta</span>           <span class="mf">0.001</span><span class="p">;</span>
<span class="linenos">26</span><span class="p">}</span>
<span class="linenos">27</span><span class="c1">// ************************************************************************* //</span>
</pre></div>
</div>
</div>
<p>The domain is split into four equally sized blocks. Again details on this can be found in the <a class="reference external" href="https://cfd.direct/openfoam/user-guide/">OpenFoam User Guide</a>.</p>
<figure class="align-center" id="fig-decomposed-mesh-fig">
<img alt="../../_images/decomposed_mesh.png" src="../../_images/decomposed_mesh.png" />
</figure>
<p>Next you need to modify the <code class="code docutils literal notranslate"><span class="pre">run.sh</span></code> script to invoke a parallel run.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cp<span class="w"> </span>run.sh<span class="w"> </span>run_par.sh
</pre></div>
</div>
<p>It should look like this:</p>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="lst-2dcav-run-tree">
<div class="code-block-caption"><span class="caption-number">Listing 10 </span><span class="caption-text">The run_par.sh file.</span><a class="headerlink" href="#lst-2dcav-run-tree" title="Link to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="ch">#!/bin/sh</span>
<span class="linenos"> 2</span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">0</span><span class="p">%/*</span><span class="si">}</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span><span class="w">    </span><span class="c1"># Run from this directory</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="c1"># Source tutorial run functions</span>
<span class="linenos"> 5</span>.<span class="w"> </span><span class="nv">$WM_PROJECT_DIR</span>/bin/tools/RunFunctions
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="nv">application</span><span class="o">=</span><span class="sb">`</span>getApplication<span class="sb">`</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span>./clean.sh
<span class="linenos">10</span>runApplication<span class="w"> </span>blockMesh
<span class="linenos">11</span>runApplication<span class="w"> </span>decomposePar
<span class="linenos">12</span>runParallel<span class="w"> </span><span class="nv">$application</span>
<span class="linenos">13</span>reconstructPar
</pre></div>
</div>
</div>
</div></blockquote>
<p>Now it’s time to run the case. Results should look like this:</p>
<figure class="align-center" id="fig-3dcavity-fig">
<img alt="../../_images/3dcavity.png" src="../../_images/3dcavity.png" />
<figcaption>
<p><span class="caption-number">Fig. 10 </span><span class="caption-text">Results of the 3-D parallel cavity flow simulation.</span><a class="headerlink" href="#fig-3dcavity-fig" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Example.html" class="btn btn-neutral float-left" title="Navier-Stokes flow with OpenFoam" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../L03/Overview.html" class="btn btn-neutral float-right" title="Lecture overview" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Lars Ruepke and Zhikui Guo.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>